(function(){var g={};
(function(window){var m,aa=this;function q(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function r(a,b){function c(){}c.prototype=b.prototype;a.kc=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.fc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(){};function ca(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}ca("error");ca("warn");ca("info");ca("log");ca("debug");function da(a){ea[a]={pa:fa(),end:NaN}}function ga(a){if(a=ea[a])a.end=fa()}function ha(a){return(a=ea[a])&&a.end?a.end-a.pa:NaN}var fa=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,ea={};function ia(a,b,c){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.active=!1}q("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function ja(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}ja.prototype.clone=function(){var a=new ja;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function ka(){this.fontSize="100%";this.fontColor=la;this.fontOpacity=ma;this.backgroundColor=na;this.backgroundOpacity=ma;this.fontEdge=oa}q("shaka.player.TextStyle",ka);ka.prototype.a=function(){var a=window.localStorage.getItem("ShakaPlayerTextStyle");if(a){var b;try{b=JSON.parse(a)}catch(c){return}if(b&&"object"==typeof b){var a=b,d;for(d in a)d in this&&(this[d]=a[d])}}};ka.prototype.load=ka.prototype.a;ka.prototype.b=function(){window.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))};
ka.prototype.store=ka.prototype.b;function pa(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+qa(a.fontColor,a.fontOpacity));b.push("background-color: "+qa(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(qa(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function qa(a,b){return"rgba("+a.concat(b).join(",")+")"}var la=[255,255,255],na=[0,0,0];
ka.StandardColors={WHITE:la,BLACK:na,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var ma=1;ka.StandardOpacities={OPAQUE:ma,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var oa=[];
ka.EdgeStyles={NONE:oa,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function ra(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}q("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function sa(a,b,c,d){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.active=!1}function ta(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}q("shaka.player.VideoTrack.compare",ta);function ua(){var a="CustomEvent"in window;if(a)try{new CustomEvent("")}catch(b){a=!1}a||(window.CustomEvent=va)}q("shaka.polyfill.CustomEvent.install",ua);function va(a,b){var c=document.createEvent("CustomEvent"),d=b||{bubbles:!1,cancelable:!1,detail:null};c.initCustomEvent(a,!!d.bubbles,!!d.cancelable,d.detail);return c};function wa(){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen;a=Document.prototype;a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen;"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}});document.addEventListener("webkitfullscreenchange",
xa);document.addEventListener("webkitfullscreenerror",xa);document.addEventListener("mozfullscreenchange",xa);document.addEventListener("mozfullscreenerror",xa);document.addEventListener("MSFullscreenChange",xa);document.addEventListener("MSFullscreenError",xa)}q("shaka.polyfill.Fullscreen.install",wa);function xa(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),b=new Event(b,a);a.target.dispatchEvent(b)};function ya(){return Promise.reject(Error("The key system specified is not supported."))}function za(a){return null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Aa(){throw new TypeError("Illegal constructor.");}Aa.prototype.createSession=function(){};Aa.prototype.setServerCertificate=function(){};function Ba(){throw new TypeError("Illegal constructor.");}Ba.prototype.getConfiguration=function(){};Ba.prototype.createMediaKeys=function(){};function u(a){this.c=[];this.b=[];this.ca=Ca;if(a)try{a(this.X.bind(this),this.a.bind(this))}catch(b){this.a(b)}}var Ca=0;function Da(){window.Promise||(window.Promise=u,window.Promise.resolve=Ea,window.Promise.reject=Fa,window.Promise.all=Ga,window.Promise.race=Ha,window.setImmediate?(Ia=function(a){return window.setImmediate(a)},Ja=function(a){return window.clearImmediate(a)}):(Ia=function(a){return window.setTimeout(a,0)},Ja=function(a){return window.clearTimeout(a)}))}
q("shaka.polyfill.Promise.install",Da);function Ea(a){var b=new u;b.X(a);return b}function Fa(a){var b=new u;b.a(a);return b}function Ga(a){function b(a,b,c){a.ca==Ca&&(e[b]=c,d++,d==e.length&&a.X(e))}var c=new u;if(!a.length)return c.X([]),c;for(var d=0,e=Array(a.length),f=c.a.bind(c),g=0;g<a.length;++g)a[g]&&a[g].then?a[g].then(b.bind(null,c,g),f):b(c,g,a[g]);return c}function Ha(a){for(var b=new u,c=b.X.bind(b),d=b.a.bind(b),e=0;e<a.length;++e)a[e]&&a[e].then?a[e].then(c,d):c(a[e]);return b}
u.prototype.then=function(a,b){var c=new u;switch(this.ca){case 1:Ka(this,c,a);break;case 2:Ka(this,c,b);break;case Ca:this.c.push({Ka:c,Ea:a}),this.b.push({Ka:c,Ea:b})}return c};u.prototype.then=u.prototype.then;u.prototype.catch=function(a){return this.then(void 0,a)};u.prototype["catch"]=u.prototype.catch;u.prototype.X=function(a){if(this.ca==Ca){this.Aa=a;this.ca=1;for(a=0;a<this.c.length;++a)Ka(this,this.c[a].Ka,this.c[a].Ea);this.c=[];this.b=[]}};
u.prototype.a=function(a){if(this.ca==Ca){this.Aa=a;this.ca=2;for(a=0;a<this.b.length;++a)Ka(this,this.b[a].Ka,this.b[a].Ea);this.c=[];this.b=[]}};function Ka(a,b,c){La.push(function(){if(c&&"function"==typeof c){try{var a=c(this.Aa)}catch(e){b.a(e);return}a instanceof u?a==b?b.a(new TypeError("Chaining cycle detected")):a.then(b.X.bind(b),b.a.bind(b)):b.X(a)}else 1==this.ca?b.X(this.Aa):b.a(this.Aa)}.bind(a));null==Na&&(Na=Ia(Oa))}
function Oa(){for(;La.length;){null!=Na&&(Ja(Na),Na=null);var a=La;La=[];for(var b=0;b<a.length;++b)a[b]()}}function Ia(){return 0}function Ja(){}var Na=null,La=[];function Pa(){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=Qa)}q("shaka.polyfill.VideoPlaybackQuality.install",Pa);function Qa(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}};function Ra(a,b){for(var c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};function Sa(){return Date.now()+Ta}var Ta=0;function Ua(a){this.b=a;this.c=0==Va;this.a=0}var Va=1;function Wa(a){return a.a<a.b.byteLength}function Xa(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function x(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Ya(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Za(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function $a(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function ab(a){this.b=a;this.a=new Ua(a);bb||(bb=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var bb;
function cb(a){var b;b=db(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=db(a);a:{for(d=0;d<bb.length;d++)if(eb(c,bb[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);$a(a.a,c);return new fb(b,d)}function db(a){var b=Xa(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Xa(a.a);return d}function fb(a,b){this.id=a;this.a=b}
function gb(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};var hb={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function ib(a){this.c=Math.exp(Math.log(.5)/a);this.a=this.b=0}ib.prototype.sample=function(a,b){var c=Math.pow(this.c,a);this.b=b*(1-c)+c*this.b;this.a+=a};function jb(a){return a.b/(1-Math.pow(a.c,a.a))};function y(a){var b=new CustomEvent(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function z(a){return new CustomEvent("error",{detail:a,bubbles:!0})};function kb(a,b,c){lb(b);lb(c);return c==b||a>=mb&&c==b.split("-")[0]||a>=nb&&c.split("-")[0]==b.split("-")[0]?!0:!1}var mb=1,nb=2;function lb(a){a=a.toLowerCase().split("-");var b=ob[a[0]];b&&(a[0]=b);return a.join("-")}
var ob={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function pb(a){return Object.keys(a).map(function(b){return a[b]})}function qb(a,b){return rb(a,b,"boolean")}function sb(a,b){var c=rb(a,b,"number");if(null==c)return null;if(isNaN(c)||c==Number.NEGATIVE_INFINITY||c==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(0>c)throw new RangeError("'"+b+"' must be >= 0");return c}function tb(a,b){return rb(a,b,"string")}
function rb(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function ub(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function A(){this.a={}}A.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};A.prototype.set=function(a,b){this.a[a]=b};A.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function vb(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function wb(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function xb(a){var b=[],c;for(c in a.a)b.push(c);return b};function B(){this.a=new A}B.prototype.destroy=function(){yb(this);this.a=null};function C(a,b,c,d){b=new zb(b,c,d);a.a.push(c,b)}B.prototype.ta=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.ta(),wb(this.a,b,e))}};function yb(a){for(var b=vb(a.a),c=0;c<b.length;++c)b[c].ta();a.a.a={}}function zb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
zb.prototype.ta=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function E(a){this.Ba=new A;this.parent=a}q("shaka.util.FakeEventTarget",E);E.prototype.addEventListener=function(a,b,c){c||this.Ba.push(a,b)};E.prototype.removeEventListener=function(a,b,c){c||wb(this.Ba,a,b)};
E.prototype.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return Ab(this,
a)};function Ab(a,b){b.currentTarget=a;for(var c=a.Ba.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.parent&&b.bubbles&&Ab(a.parent,b);return b.defaultPrevented};function Bb(){E.call(this,null);this.a=new ib(3);this.c=new ib(10);this.b=0}r(Bb,E);q("shaka.util.EWMABandwidthEstimator",Bb);Bb.prototype.sample=function(a,b){if(!(65536>b)){a=Math.max(a,50);var c=8E3*b/a,d=a/1E3;this.a.sample(d,c);this.c.sample(d,c);this.dispatchEvent(y({type:"bandwidth"}));this.b=Date.now()}};Bb.prototype.getBandwidth=function(){return.5>this.a.a?5E5:Math.min(jb(this.a),jb(this.c))};Bb.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};
Bb.prototype.supportsCaching=function(){return!1};function F(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=F.prototype.destroy;return c}F.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function Cb(a){return a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function Db(){this.g=new F;this.f=!1;this.a=null;this.b=[];this.c=null}function G(a,b){if(a.f)throw Error("Cannot append to a running task!");a.b.push(b)}Db.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0;this.b.unshift(function(){});Eb(this,void 0)};function Fb(a){if(a.a)return a.a;if(!a.f)return a.f=!0,Promise.resolve();a.c&&a.c();a.a=new F;return a.a}Db.prototype.end=function(){this.b.splice(1)};
function Eb(a,b){var c=a.b[0](b),d;c?(d=c[0],a.c=c[1]):(d=Promise.resolve(),a.c=null);d.then(H(a,function(a){this.a?(this.b=[],this.c=null,Gb(this)):(this.b.shift(),this.b.length?Eb(this,a):(this.g.resolve(a),this.c=null))})).catch(H(a,function(a){this.b=[];this.c=null;this.a?Gb(this):this.g.reject(a)}))}function Gb(a){var b=Error("Task aborted.");b.type="aborted";a.g.reject(b);window.setTimeout(function(){this.a.resolve();this.a=null}.bind(a),5)};function H(a,b){return b.bind(a)};function Hb(a,b){E.call(this,b);this.a=null;this.h=a}r(Hb,E);
function Ib(a){if(!window.indexedDB)return a=Error("Persistant storage requires IndexedDB support."),a.type="storage",Promise.reject(a);if(a.a)return a=Error("A database connection is already open."),a.type="storage",Promise.reject(a);var b=new F,c=window.indexedDB.open("content_database",1);c.onupgradeneeded=H(a,function(a){this.a=a.target.result;Jb(this,"group_store",{keyPath:"group_id"});Jb(this,"stream_index_store",{keyPath:"stream_id"});a=Jb(this,"content_store",{autoIncrement:"true"});a.createIndex("segment",
["stream_id","segment_id"],{unique:!0});a.createIndex("stream","stream_id",{unique:!1})});c.onsuccess=H(a,function(a){this.a=a.target.result;b.resolve()});c.onerror=function(){b.reject(c.error)};return b}function Kb(a){a.a&&(a.a.close(),a.a=null)}function Jb(a,b,c){a.a.objectStoreNames.contains(b)&&a.a.deleteObjectStore(b);return a.a.createObjectStore(b,c)}function Lb(a){return Mb(a,"content_store")}function Nb(a){return Mb(a,"stream_index_store")}function Ob(a){return Mb(a,"group_store")}
function Mb(a,b){return a.a.transaction([b],a.h).objectStore(b)}function Pb(a,b){var c=new F,d=a.get(b);d.onerror=function(){c.reject(d.error)};d.onsuccess=function(){if(d.result)c.resolve(d.result);else{var a=Error("Item not found.");a.type="storage";c.reject(a)}};return c};function Qb(){Hb.call(this,"readonly",null)}r(Qb,Hb);function Rb(a){var b=new F,c=[],d=Ob(a).openCursor();d.onerror=function(){b.reject(d.error)};d.onsuccess=function(a){(a=a.target.result)?(c.push(a.key),a.continue()):b.resolve(c)};return b}
function Sb(a,b){return Pb(Ob(a),b).then(H(a,function(a){a.session_ids=Ra(a.session_ids);return a.hasOwnProperty("duration")||a.hasOwnProperty("key_system")?Promise.resolve(a):Tb(this,a.stream_ids[0]).then(function(b){a.duration=b.duration;a.key_system=b.key_system;a.license_server=b.license_server;a.with_credentials=b.with_credentials;a.distinctive_identifier=b.distinctive_identifier;a.audio_robustness=b.audio_robustness;a.video_robustness=b.video_robustness;return Promise.resolve(a)})}))}
function Tb(a,b){return Pb(Nb(a),b)}function Ub(a,b,c){return Pb(Lb(a).index("segment"),[b,c]).then(function(a){return Promise.resolve(a.content)})};function Vb(a,b,c){MediaSource.isTypeSupported(b);b=a.addSourceBuffer(b);this.h=a;this.c=b;this.o=c;this.j=new B;this.g=null;this.b=[];this.A=0;this.f=this.a=null;this.v=0;C(this.j,this.c,"updateend",this.D.bind(this))}var Wb=1/60;Vb.prototype.destroy=function(){Xb(this).catch(function(){});this.f&&this.f.destroy();this.a=this.f=null;this.g&&(Kb(this.g),this.g=null);this.b=null;this.j.destroy();this.h=this.c=this.j=null};
function Yb(a,b){for(var c=a.c.buffered,d=0;d<c.length;++d){var e=c.start(d)-Wb,f=c.end(d)+Wb;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function Zb(a,b,c,d){if(a.a)return a=Error("Cannot fetch ("+a.l+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Db;c!=a.c.timestampOffset&&(a.c.timestampOffset=c);"idb"!=b.url.b[0].P||a.g||(a.g=new Qb,G(a.a,function(){return[Ib(this.g)]}.bind(a)));d&&G(a.a,function(){return[$b(this,d),this.i.bind(this)]}.bind(a));G(a.a,function(){var a=b.endTime?b.endTime-b.startTime:1,c=new ac;c.a=10;c.g=1E3*a;c.b=1E3*this.v;c.i=this.g;return[bc(b.url,c,this.o),I.prototype.f.bind(b.url)]}.bind(a));
G(a.a,H(a,function(a){this.o.getBandwidth();return[$b(this,a),this.i.bind(this)]}));var e=0==a.c.buffered.length&&0==a.b.length,f=null;G(a.a,function(){if(0==this.c.buffered.length){var a=Error("Failed to buffer segment ("+this.l+").");a.type="stream";return[Promise.reject(a)]}e&&(a=b.startTime,f=this.c.buffered.start(0)-a);a=cc(this.b,b.startTime);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return dc(a).then(function(){return Promise.resolve(f)}.bind(a))}
function ec(a){if(a.a)return a=Error("Cannot clear ("+a.l+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Db;G(a.a,function(){var a;a:if(0==this.c.buffered.length)a=Promise.resolve();else{try{this.c.remove(0,this.h.duration)}catch(c){a=Promise.reject(c);break a}this.b=[];a=this.f=new F}return[a,this.i.bind(this)]}.bind(a));return dc(a)}
function fc(a,b){if(a.a){var c=Error("Cannot clearAfter ("+a.l+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.a=new Db;G(a.a,function(){return[gc(this,b),this.i.bind(this)]}.bind(a));return dc(a)}function Xb(a){return a.a?Fb(a.a):Promise.resolve()}function dc(a){a.a.start();return a.a.g.then(H(a,function(){this.a=null})).catch(H(a,function(a){this.a=null;return Promise.reject(a)}))}
function $b(a,b){try{a.c.appendBuffer(b)}catch(c){return Promise.reject(c)}a.f=new F;return a.f}function gc(a,b){if(0==a.c.buffered.length)return Promise.resolve();var c=cc(a.b,b);if(-1==c||c==a.b.length-1)return Promise.resolve();try{a.c.remove(a.b[c+1].startTime,a.h.duration)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.f=new F;return a.f}Vb.prototype.i=function(){this.f&&"open"==this.h.readyState&&this.c.abort()};Vb.prototype.D=function(){this.f&&(this.f.resolve(),this.f=null)};function hc(a){return String.fromCharCode.apply(null,a)}q("shaka.util.Uint8ArrayUtils.toString",hc);function ic(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}q("shaka.util.Uint8ArrayUtils.fromString",ic);q("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(hc(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function jc(a){return ic(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
q("shaka.util.Uint8ArrayUtils.fromBase64",jc);q("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function kc(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}q("shaka.util.Uint8ArrayUtils.toHex",kc);function eb(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function lc(){this.h=this.a="";this.i=!1;this.v=this.o=null;this.l=this.g=!1;this.j=this.f="";this.c=null;this.b=[]}
function mc(a){var b=new lc;if(!a)return b;var c=tb(a,"keySystem");if(null!=c)b.a=c;else throw Error("'keySystem' cannot be null.");var d=tb(a,"licenseServerUrl");if(null!=d)b.h=d;else if(c)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");c=qb(a,"withCredentials");null!=c&&(b.i=c);c=ub(a,"licensePostProcessor",Function);null!=c&&(b.o=c);c=ub(a,"licensePreProcessor",Function);null!=c&&(b.v=c);c=qb(a,"distinctiveIdentifierRequired");null!=c&&(b.g=c);c=qb(a,
"persistentStateRequired");null!=c&&(b.l=c);c=tb(a,"audioRobustness");null!=c&&(b.f=c);c=tb(a,"videoRobustness");null!=c&&(b.j=c);c=ub(a,"serverCertificate",Uint8Array);null!=c&&(b.c=c);if(c=ub(a,"initData",Object)){a=ub(c,"initData",Uint8Array);if(null==a)throw Error("'initData.initData' cannot be null.");c=tb(c,"initDataType");if(null==c)throw Error("'initData.initDataType' cannot be null.");b.b.push({initData:new Uint8Array(a.buffer),initDataType:c})}return b}
function nc(a,b){var c=new lc;c.a=a.a;c.h=a.h;c.i=a.i;c.o=a.o;c.v=a.v;c.g=a.g;c.l=a.l;c.f=a.f;c.j=a.j;c.c=a.c?new Uint8Array(a.c.buffer):null;oc(c,a.b);oc(c,b.b);return c}function oc(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=Ra(c,pc)}function pc(a,b){return a.initDataType==b.initDataType&&eb(a.initData,b.initData)};function qc(a,b){try{var c=new rc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}function sc(a){var b=this.mediaKeys;b&&b!=a&&tc(b,null);delete this.mediaKeys;(this.mediaKeys=a)&&tc(a,this);return Promise.resolve()}
function rc(a,b){this.a=this.keySystem=a;var c=!0;"org.w3.clearkey"==a&&(this.a="webkit-org.w3.clearkey",c=!1);var d=!1,e;e=document.getElementsByTagName("video");e=e.length?e[0]:document.createElement("video");for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"]},l=!1;if(g.audioCapabilities)for(var k=0;k<g.audioCapabilities.length;++k){var p=g.audioCapabilities[k];
p.contentType&&(l=!0,e.canPlayType(p.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(p),d=!0))}if(g.videoCapabilities)for(k=0;k<g.videoCapabilities.length;++k)p=g.videoCapabilities[k],p.contentType&&(l=!0,e.canPlayType(p.contentType,this.a)&&(h.videoCapabilities.push(p),d=!0));l||(d=e.canPlayType("video/mp4",this.a)||e.canPlayType("video/webm",this.a));"required"==g.persistentState&&(c?(h.persistentState="required",h.sessionTypes=["persistent-license"]):d=!1);if(d){this.b=h;return}}c=
"Unsupported keySystem";if("org.w3.clearkey"==a||"com.widevine.alpha"==a)c="None of the requested configurations were supported.";c=Error(c);c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}rc.prototype.createMediaKeys=function(){var a=new uc(this.a);return Promise.resolve(a)};rc.prototype.getConfiguration=function(){return this.b};function uc(a){this.g=a;this.b=null;this.a=new B;this.c=[];this.f={}}
function tc(a,b){a.b=b;yb(a.a);b&&(C(a.a,b,"webkitneedkey",a.Sb.bind(a)),C(a.a,b,"webkitkeymessage",a.Rb.bind(a)),C(a.a,b,"webkitkeyadded",a.Pb.bind(a)),C(a.a,b,"webkitkeyerror",a.Qb.bind(a)))}m=uc.prototype;m.createSession=function(a){var b=a||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+a+" is unsupported on this platform.");a=this.b||document.createElement("video");a.src||(a.src="about:blank");b=new vc(a,this.g,b);this.c.push(b);return b};
m.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};m.Sb=function(a){a=y({type:"encrypted",initDataType:"webm",initData:a.initData});this.b.dispatchEvent(a)};m.Rb=function(a){var b=wc(this,a.sessionId);b&&(a=y({type:"message",messageType:void 0==b.keyStatuses.Ia()?"licenserequest":"licenserenewal",message:a.message}),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a))};
m.Pb=function(a){if(a=wc(this,a.sessionId))xc(a,"usable"),a.a&&a.a.resolve(),a.a=null};
m.Qb=function(a){var b=wc(this,a.sessionId);if(b){var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45==a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?xc(b,"output-restricted"):1==c?xc(b,"expired"):xc(b,"internal-error"))}};
function wc(a,b){var c=a.f[b];return c?c:(c=a.c.shift())?(c.sessionId=b,a.f[b]=c):null}function vc(a,b,c){E.call(this,null);this.f=a;this.h=!1;this.a=this.b=null;this.c=b;this.g=c;this.sessionId="";this.expiration=NaN;this.closed=new F;this.keyStatuses=new yc}r(vc,E);
function zc(a,b,c){if(a.h)return Promise.reject(Error("The session is already initialized."));a.h=!0;var d;try{if("persistent-license"==a.g)if(c)d=ic("LOAD_SESSION|"+c);else{var e=new Uint8Array(b);d=ic("PERSISTENT|"+hc(e))}else d=new Uint8Array(b)}catch(f){return Promise.reject(f)}a.b=new F;try{a.f.webkitGenerateKeyRequest(a.c,d)}catch(g){if("InvalidStateError"!=g.name)return a.b=null,Promise.reject(g);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,d)}catch(a){this.b.reject(a),
this.b=null}}.bind(a),10)}return a.b}m=vc.prototype;m.Va=function(a,b){if(this.a)this.a.then(this.Va.bind(this,a,b)).catch(this.Va.bind(this,a,b));else{this.a=a;var c,d;"webkit-org.w3.clearkey"==this.c?(c=hc(new Uint8Array(b)),d=JSON.parse(c),"oct"!=d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),c=jc(d.keys[0].k),d=jc(d.keys[0].kid)):(c=new Uint8Array(b),d=null);try{this.f.webkitAddKey(this.c,c,d,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}};
function xc(a,b){a.keyStatuses.Pa(b);var c=y({type:"keystatuseschange"});a.dispatchEvent(c)}m.generateRequest=function(a,b){return zc(this,b,null)};m.load=function(a){return"persistent-license"==this.g?zc(this,null,a):Promise.reject(Error("Not a persistent session."))};m.update=function(a){var b=new F;this.Va(b,a);return b};
m.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}this.closed.resolve();return this.closed};m.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};function yc(){this.size=0;this.a=void 0}var Ac;m=yc.prototype;m.Pa=function(a){this.size=void 0==a?0:1;this.a=a};m.Ia=function(){return this.a};
m.forEach=function(a){this.a&&a(Ac,this.a)};m.get=function(a){if(this.has(a))return this.a};m.has=function(a){var b=Ac;return this.a&&eb(new Uint8Array(a),new Uint8Array(b))?!0:!1};function Bc(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Ua(new DataView(a.buffer));try{for(;Wa(a);){var b=a.a,c=x(a),d=x(a);1==c?c=Ya(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)$a(a,c-(a.a-b));else{var e=Xa(a);if(1<e)$a(a,c-(a.a-b));else{$a(a,3);var f=kc(Za(a)),g=[];if(0<e)for(var h=x(a),l=0;l<h;++l){var k=kc(Za(a));g.push(k)}var p=x(a);$a(a,p);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&$a(a,c-(a.a-b))}}}}catch(n){}}
;function Cc(a,b){try{var c=new Dc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}
function Dc(a,b){this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"]},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];if(l.contentType){var g=!0,k=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,k)&&(f.audioCapabilities.push(l),c=!0)}}if(e.videoCapabilities)for(h=
0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,k=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,k)&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==e.persistentState&&(f.persistentState="required",f.sessionTypes=["persistent-license"]);if(c){this.a=f;return}}c=Error("Unsupported keySystem");c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}
Dc.prototype.createMediaKeys=function(){var a=new Ec(this.keySystem);return Promise.resolve(a)};Dc.prototype.getConfiguration=function(){return this.a};function Fc(a){var b=this.mediaKeys;b&&b!=a&&Gc(b,null);delete this.mediaKeys;return(this.mediaKeys=a)?Gc(a,this):Promise.resolve()}function Ec(a){this.a=new MSMediaKeys(a);this.b=new B}Ec.prototype.createSession=function(a){if("temporary"!=(a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new Hc(this.a)};
Ec.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};function Gc(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener("loadedmetadata",c)}yb(a.b);if(!b)return Promise.resolve();C(a.b,b,"msneedkey",Ic);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener("loadedmetadata",c),Promise.resolve()}catch(e){return Promise.reject(e)}}
function Hc(a){E.call(this,null);this.c=null;this.g=a;this.b=this.a=null;this.f=new B;this.sessionId="";this.expiration=NaN;this.closed=new F;this.keyStatuses=new Jc}r(Hc,E);m=Hc.prototype;m.generateRequest=function(a,b){this.a=new F;try{this.c=this.g.createSession("video/mp4",new Uint8Array(b),null),C(this.f,this.c,"mskeymessage",this.Gb.bind(this)),C(this.f,this.c,"mskeyadded",this.Eb.bind(this)),C(this.f,this.c,"mskeyerror",this.Fb.bind(this)),Kc(this,"status-pending")}catch(c){this.a.reject(c)}return this.a};
m.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))};m.update=function(a){this.b=new F;try{this.c.update(new Uint8Array(a))}catch(b){this.b.reject(b)}return this.b};m.close=function(){try{this.c.close(),this.closed.resolve(),yb(this.f)}catch(a){this.closed.reject(a)}return this.closed};m.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function Ic(a){var b=a.initData;if(b){var c=new Bc(b);if(1>=c.a.length)a=b;else{var d=[];for(a=0;a<c.a.length;a++)d.push(b.subarray(c.a[a].start,c.a[a].end+1));b=Ra(d,Lc);for(a=c=0;a<b.length;a++)c+=b[a].length;c=new Uint8Array(c);for(a=d=0;a<b.length;a++)c.set(b[a],d),d+=b[a].length;a=c}}else a=b;a=y({type:"encrypted",initDataType:"cenc",initData:a});this.dispatchEvent(a)}function Lc(a,b){return eb(a,b)}
m.Gb=function(a){this.a&&(this.a.resolve(),this.a=null);a=y({type:"message",messageType:void 0==this.keyStatuses.Ia()?"licenserequest":"licenserenewal",message:a.message.buffer});this.dispatchEvent(a)};m.Eb=function(){this.a?(this.a.resolve(),this.a=null):this.b&&(Kc(this,"usable"),this.b.resolve(),this.b=null)};
m.Fb=function(){var a=Error("EME v20140218 key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Kc(this,"output-not-allowed");default:Kc(this,"internal-error")}};function Kc(a,b){a.keyStatuses.Pa(b);var c=y({type:"keystatuseschange"});a.dispatchEvent(c)}function Jc(){this.size=0;this.a=void 0}var Mc;
m=Jc.prototype;m.Pa=function(a){this.size=void 0==a?0:1;this.a=a};m.Ia=function(){return this.a};m.forEach=function(a){this.a&&a(Mc,this.a)};m.get=function(a){if(this.has(a))return this.a};m.has=function(a){var b=Mc;return this.a&&eb(new Uint8Array(a),new Uint8Array(b))?!0:!1};function Nc(){Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(Ac=(new Uint8Array([0])).buffer,Navigator.prototype.requestMediaKeySystemAccess=qc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=sc,window.MediaKeys=uc,window.MediaKeySystemAccess=rc):window.MSMediaKeys?(Mc=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,
HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Fc,window.MediaKeys=Ec,window.MediaKeySystemAccess=Dc,Navigator.prototype.requestMediaKeySystemAccess=Cc):(Navigator.prototype.requestMediaKeySystemAccess=ya,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=za,window.MediaKeys=Aa,window.MediaKeySystemAccess=Ba))}q("shaka.polyfill.MediaKeys.install",Nc);q("shaka.polyfill.installAll",function(){ua();wa();Pa();Da();Nc()});function Oc(){this.parse=function(a,b){function c(a,b){l.push({message:a,ic:e+1,hc:b})}var d=Date.now(),e=0,f=a.split(/\r\n|\r|\n/),g=!1,h=[],l=[],k=f[e],p=k.length,n=0,t=6;"\ufeff"===k[0]&&(n=1,t+=1);(p<t||k.indexOf("WEBVTT")!==0+n||p>t&&" "!==k[t]&&"\t"!==k[t])&&c('No valid signature. (File needs to start with "WEBVTT".)');for(e++;""!=f[e]&&void 0!=f[e];){c("No blank line after the signature.");if(-1!=f[e].indexOf("--\x3e")){g=!0;break}e++}for(;void 0!=f[e];){for(;!g&&""==f[e];)e++;if(!g&&void 0==
f[e])break;k={id:"",startTime:0,endTime:0,jc:!1,direction:"horizontal",$b:!0,xb:"auto",ac:50,size:100,wb:"middle",text:"",dc:null};p=!0;if(-1==f[e].indexOf("--\x3e")){k.id=f[e];if(/^NOTE($|[ \t])/.test(k.id)){for(e++;""!=f[e]&&void 0!=f[e];)-1!=f[e].indexOf("--\x3e")&&c("Cannot have timestamp in a comment."),e++;continue}e++;if(""==f[e]||void 0==f[e]){c("Cue identifier cannot be standalone.");continue}-1==f[e].indexOf("--\x3e")&&(p=!1,c("Cue identifier needs to be followed by timestamp."))}g=!1;n=
new Pc(f[e],c);t=0;0<h.length&&(t=h[h.length-1].startTime);if(p&&!n.parse(k,t))for(k=null,e++;""!=f[e]&&void 0!=f[e];){if(-1!=f[e].indexOf("--\x3e")){g=!0;break}e++}else{for(e++;""!=f[e]&&void 0!=f[e];){if(-1!=f[e].indexOf("--\x3e")){c("Blank line missing before cue.");g=!0;break}""!=k.text&&(k.text+="\n");k.text+=f[e];e++}k.dc=(new Qc(k.text,c,b)).parse(k.startTime,k.endTime);h.push(k)}}h.sort(function(a,b){return a.startTime<b.startTime?-1:a.startTime>b.startTime?1:a.endTime>b.endTime?-1:a.endTime<
b.endTime?1:0});return{cues:h,a:l,time:Date.now()-d}}}
function Pc(a,b){function c(a){b(a,k+1)}function d(a){for(;void 0!=l[k]&&a.test(l[k]);)k++}function e(){for(var a=/\d/,b="";void 0!=l[k]&&a.test(l[k]);)b+=l[k],k++;return b}function f(){var a="minutes",b,d,f;if(void 0==l[k])c("No timestamp found.");else if(/\d/.test(l[k])){b=e();if(2<b.length||59<parseInt(b,10))a="hours";if(":"!=l[k])c("No time unit separator found.");else if(k++,d=e(),2!=d.length)c("Must be exactly two digits.");else{if("hours"==a||":"==l[k]){if(":"!=l[k]){c("No seconds found or minutes is greater than 59.");
return}k++;a=e();if(2!=a.length){c("Must be exactly two digits.");return}}else a=d,d=b,b="0";if("."!=l[k])c('No decimal separator (".") found.');else if(k++,f=e(),3!=f.length)c("Milliseconds must be given in three digits.");else if(59<parseInt(d,10))c("You cannot have more than 59 minutes.");else if(59<parseInt(a,10))c("You cannot have more than 59 seconds.");else return 3600*parseInt(b,10)+60*parseInt(d,10)+parseInt(a,10)+parseInt(f,10)/1E3}}else c("Timestamp must start with a character in the range 0-9.")}
var g=/[\u0020\t\f]/,h=/[^\u0020\t\f]/,l=a,k=0;this.parse=function(a,b){d(g);a.startTime=f();if(void 0!=a.startTime)if(a.startTime<b&&c("Start timestamp is not greater than or equal to start timestamp of previous cue."),h.test(l[k])&&c("Timestamp not separated from '--\x3e' by whitespace."),d(g),"-"!=l[k])c("No valid timestamp separator found.");else if(k++,"-"!=l[k])c("No valid timestamp separator found.");else if(k++,">"!=l[k])c("No valid timestamp separator found.");else if(k++,h.test(l[k])&&c("'--\x3e' not separated from timestamp by whitespace."),
d(g),a.endTime=f(),void 0!=a.endTime){a.endTime<=a.startTime&&c("End timestamp is not greater than start timestamp.");h.test(l[k]);d(g);for(var e=l.substring(k).split(g),D=[],w=0;w<e.length;w++)if(""!=e[w]){var v=e[w].indexOf(":"),L=e[w].slice(0,v),v=e[w].slice(v+1);-1!=D.indexOf(L)&&c("Duplicate setting.");D.push(L);if(""==v){c("No value for setting defined.");break}if("vertical"==L)"rl"!=v&&"lr"!=v?c("Writing direction can only be set to 'rl' or 'rl'."):a.direction=v;else if("line"==L)if(/\d/.test(v))if(-1!=
v.indexOf("-",1))c("Line position can only have '-' at the start.");else if(-1!=v.indexOf("%")&&v.indexOf("%")!=v.length-1)c("Line position can only have '%' at the end.");else if("-"==v[0]&&"%"==v[v.length-1])c("Line position cannot be a negative percentage.");else{if("%"==v[v.length-1]){if(100<parseInt(v,10)){c("Line position cannot be >100%.");continue}a.$b=!1}a.xb=parseInt(v,10)}else c("Line position takes a number or percentage.");else"position"==L?"%"!=v[v.length-1]?c("Text position must be a percentage."):
100<parseInt(v,10)?c("Size cannot be >100%."):a.ac=parseInt(v,10):"size"==L?"%"!=v[v.length-1]?c("Size must be a percentage."):100<parseInt(v,10)?c("Size cannot be >100%."):a.size=parseInt(v,10):"align"==L?(L=["start","middle","end","left","right"],-1==L.indexOf(v)?c("Alignment can only be set to one of "+L.join(", ")+"."):a.wb=v):c("Invalid setting.")}return!0}};this.a=function(){var a=f();if(void 0!=l[k])c("Timestamp must not have trailing characters.");else return a}}
function Qc(a,b,c){function d(a){"metadata"!=c&&b(a,g+1)}function e(){for(var a="data",b="",c="",e=[];void 0!=f[g-1]||0==g;){var n=f[g];if("data"==a)if("&"==n)c=n,a="escape";else if("<"==n&&""==b)a="tag";else{if("<"==n||void 0==n)return["text",b];b+=n}else if("escape"==a)if("&"==n)d("Incorrect escape."),b+=c,c=n;else if(/[abglmnsprt]/.test(n))c+=n;else{if(";"==n)"&amp"==c?b+="&":"&lt"==c?b+="<":"&gt"==c?b+=">":"&lrm"==c?b+="\u200e":"&rlm"==c?b+="\u200f":"&nbsp"==c?b+="\u00a0":(d("Incorrect escape."),
b+=c+";");else{if("<"==n||void 0==n)return d("Incorrect escape."),b+=c,["text",b];d("Incorrect escape.");b+=c+n}a="data"}else if("tag"==a)if("\t"==n||"\n"==n||"\f"==n||" "==n)a="start tag annotation";else if("."==n)a="start tag class";else if("/"==n)a="end tag";else if(/\d/.test(n))b=n,a="timestamp tag";else{if(">"==n||void 0==n)return">"==n&&g++,["start tag","",[],""];b=n;a="start tag"}else if("start tag"==a)if("\t"==n||"\f"==n||" "==n)a="start tag annotation";else if("\n"==n)c=n,a="start tag annotation";
else if("."==n)a="start tag class";else{if(">"==n||void 0==n)return">"==n&&g++,["start tag",b,[],""];b+=n}else if("start tag class"==a)if("\t"==n||"\f"==n||" "==n)e.push(c),c="",a="start tag annotation";else if("\n"==n)e.push(c),c=n,a="start tag annotation";else if("."==n)e.push(c),c="";else{if(">"==n||void 0==n)return">"==n&&g++,e.push(c),["start tag",b,e,""];c+=n}else if("start tag annotation"==a){if(">"==n||void 0==n)return">"==n&&g++,c=c.split(/[\u0020\t\f\r\n]+/).filter(function(a){if(a)return!0}).join(" "),
["start tag",b,e,c];c+=n}else if("end tag"==a){if(">"==n||void 0==n)return">"==n&&g++,["end tag",b];b+=n}else if("timestamp tag"==a){if(">"==n||void 0==n)return">"==n&&g++,["timestamp",b];b+=n}else d("Never happens.");g++}}var f=a,g=0;this.parse=function(a,b){function k(a){t.children.push({type:"object",name:a[1],gc:a[2],children:[],parent:t});t=t.children[t.children.length-1]}function p(){for(var a=t;a;){if("v"==a.name)return!0;a=a.parent}}for(var n={children:[]},t=n,D=[];void 0!=f[g];){var w=e();
if("text"==w[0])t.children.push({type:"text",value:w[1],parent:t});else if("start tag"==w[0]){"chapters"==c&&d("Start tags not allowed in chapter title text.");var v=w[1];"v"!=v&&"lang"!=v&&""!=w[3]&&d("Only <v> and <lang> can have an annotation.");"c"==v||"i"==v||"b"==v||"u"==v||"ruby"==v?k(w):"rt"==v&&"ruby"==t.name?k(w):"v"==v?(p()&&d("<v> cannot be nested inside itself."),k(w),t.value=w[3],w[3]||d("<v> requires an annotation.")):"lang"==v?(k(w),t.value=w[3]):d("Incorrect start tag.")}else"end tag"==
w[0]?("chapters"==c&&d("End tags not allowed in chapter title text."),w[1]==t.name?t=t.parent:"ruby"==w[1]&&"rt"==t.name?t=t.parent.parent:d("Incorrect end tag.")):"timestamp"==w[0]&&("chapters"==c&&d("Timestamp not allowed in chapter title text."),w=(new Pc(w[1],d)).a(),void 0!=w&&((w<=a||w>=b)&&d("Timestamp must be between start timestamp and end timestamp."),0<D.length&&D[D.length-1]>=w&&d("Timestamp must be greater than any previous timestamp."),t.children.push({type:"timestamp",value:w,parent:t}),
D.push(w)))}for(;t.parent;)"v"!=t.name&&d("Required end tag missing."),t=t.parent;return n}};function Rc(a,b){this.l=a;this.f=b;this.h="";this.g=null;this.i=new B;this.b=[];this.c=this.a=null}Rc.prototype.destroy=function(){Sc(this).catch(function(){});this.c&&this.c.destroy();this.b=this.a=this.c=null;this.i.destroy();this.i=null;this.h=""};
function Tc(a,b){var c,d=0;if((a.f||[]).length)try{c=Uc(a,a.h);var e=a.b.slice(0).filter(function(a){return-1!==a.url.toString().indexOf(c.label)}).sort(function(a,b){return b.endTime-a.endTime})[0],d=e&&e.endTime-b||0}catch(f){d=Number.POSITIVE_INFINITY}return d}
function Vc(a,b,c){a.h=c.id;if(a.a)return a=Error("Cannot fetch: previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Db;G(a.a,function(){var a=b.endTime?b.endTime-b.startTime:1,c=new ac;c.a=3;c.g=1E3*a;c.b=0;c.f="text";return[bc(b.url,c,null),I.prototype.f.bind(b.url)]}.bind(a));G(a.a,H(a,function(a){return[this.o.call(this,a,c),this.j.bind(this)]}));G(a.a,function(){var a=cc(this.b,b.startTime);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return Wc(a).then(function(){return Promise.resolve(0)}.bind(a))}
function Xc(a){if(a.a)return a=Error("Cannot clear ("+a.h+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new Db;G(a.a,function(){var a;if(0==this.f.length)a=Promise.resolve();else try{Yc(this),this.b=[],this.h="",a=Promise.resolve()}catch(c){a=Promise.reject(c)}return[a,this.j.bind(this)]}.bind(a));return Wc(a)}function Sc(a){return a.a?Fb(a.a):Promise.resolve()}
function Wc(a){a.a.start();return a.a.g.then(H(a,function(){this.a=null})).catch(H(a,function(a){this.a=null;return Promise.reject(a)}))}
Rc.prototype.o=function(a,b){try{var c=-1!==a.indexOf("--\x3e"),d=$c(this,b.id,b.C?b.C.F.lang:"");c&&(new Oc).parse(a).cues.forEach(function(a){var b=Array.prototype.slice.call(d.cues||[]).slice(-10).filter(function(b){return b.text===a.text}).slice(-1)[0];b?b.endTime=a.endTime:d.addCue(new VTTCue(a.startTime,a.endTime,a.text))})}catch(e){return Promise.reject(e)}setTimeout(function(){new Event("someEvent");this.c.resolve();this.c=null}.bind(this),0);return this.c=new F};Rc.prototype.j=function(){};
function $c(a,b,c){var d=Uc(a,b);d||(d=a.l.addTextTrack("subtitles",b,c));return d}function Yc(a){a.f&&Array.prototype.slice.call(a.f).forEach(function(a){Array.prototype.slice.call(a.cues||[]).forEach(function(c){a.removeCue(c)})})}function ad(a,b,c){var d=c?"showing":"hidden";"undefined"===b&&c||a.g&&a.g.enabled===c&&a.g.id===b||(a.g=null,Array.prototype.slice.call(a.f).forEach(function(a){a.mode=a.label===b?d:"hidden";a.label===b&&(this.g={id:b,enabled:c})}.bind(a)))}
function Uc(a,b){var c=Array.prototype.slice.call(a.f).filter(function(a){return a.label===b});return c.length?c[0]:null};var bd=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function J(a){var b;a instanceof J?(cd(this,a.P),this.da=a.da,this.S=a.S,dd(this,a.ka),this.O=a.O,ed(this,a.a.clone()),this.ba=a.ba):a&&(b=String(a).match(bd))?(cd(this,b[1]||"",!0),this.da=fd(b[2]||""),this.S=fd(b[3]||"",!0),dd(this,b[4]),this.O=fd(b[5]||"",!0),ed(this,b[6]||"",!0),this.ba=fd(b[7]||"")):this.a=new gd(null)}m=J.prototype;m.P="";m.da="";m.S="";m.ka=null;m.O="";m.ba="";
m.toString=function(){var a=[],b=this.P;b&&a.push(hd(b,id,!0),":");if(b=this.S){a.push("//");var c=this.da;c&&a.push(hd(c,id,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.ka;null!=b&&a.push(":",String(b))}if(b=this.O)this.S&&"/"!=b.charAt(0)&&a.push("/"),a.push(hd(b,"/"==b.charAt(0)?jd:kd,!0));(b=this.a.toString())&&a.push("?",b);(b=this.ba)&&a.push("#",hd(b,ld));return a.join("")};
m.resolve=function(a){var b=this.clone();"data"===b.P&&(b=new J);var c=!!a.P;c?cd(b,a.P):c=!!a.da;c?b.da=a.da:c=!!a.S;c?b.S=a.S:c=null!=a.ka;var d=a.O;if(c)dd(b,a.ka);else if(c=!!a.O){if("/"!=d.charAt(0))if(this.S&&!this.O)d="/"+d;else{var e=b.O.lastIndexOf("/");-1!=e&&(d=b.O.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==h?((1<f.length||
1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.O=d:c=""!==a.a.toString();c?ed(b,a.a.clone()):c=!!a.ba;c&&(b.ba=a.ba);return b};m.clone=function(){return new J(this)};function cd(a,b,c){a.P=c?fd(b,!0):b;a.P&&(a.P=a.P.replace(/:$/,""))}function dd(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.ka=b}else a.ka=null}function ed(a,b,c){b instanceof gd?a.a=b:(c||(b=hd(b,md)),a.a=new gd(b))}
function fd(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function hd(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,nd),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function nd(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var id=/[#\/\?@]/g,kd=/[\#\?:]/g,jd=/[\#\?]/g,md=/[\#\?@]/g,ld=/#/g;function gd(a){this.b=a||null}gd.prototype.a=null;gd.prototype.c=null;
function od(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,h=null;0<=f?(g=d[e].substring(0,f),h=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));h=h||"";od(a,g,decodeURIComponent(h.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
gd.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};gd.prototype.clone=function(){var a=new gd;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function pd(){this.id=this.url=null;this.type="static";this.b=this.j=this.u=this.kb=null;this.h=5;this.f=this.c=this.g=null;this.i=1;this.a=[]}function qd(){this.w=this.f=this.c=this.u=this.a=this.start=this.id=null;this.b=[]}function rd(){this.h=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.c=!1;this.w=this.g=this.f=this.u=null;this.i=[];this.a=[]}function sd(){this.value=null}function td(){this.contentType=this.lang=this.id=null}
function ud(){this.w=this.a=this.f=this.u=this.g=this.c=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.b=[]}function vd(){this.b=this.a=this.c=this.f=null}function wd(){this.parsedPssh=this.psshBox=null}function xd(){this.url=null}function yd(){this.url=null}function zd(){this.u=null;this.g=1;this.c=this.b=this.a=this.f=null}zd.prototype.clone=function(){var a=new zd;a.u=Ad(this.u);a.g=this.g;a.f=this.f;a.a=K(this.a);a.b=K(this.b);a.c=K(this.c);return a};
function Bd(){this.a=this.url=null}Bd.prototype.clone=function(){var a=new Bd;a.url=Ad(this.url);a.a=K(this.a);return a};function Cd(){this.a=this.url=null}Cd.prototype.clone=function(){var a=new Cd;a.url=Ad(this.url);a.a=K(this.a);return a};function Dd(){this.u=null;this.f=1;this.b=this.g=null;this.i=1;this.h=null;this.a=[];this.c=null}Dd.prototype.clone=function(){var a=new Dd;a.u=Ad(this.u);a.f=this.f;a.g=this.g;a.b=this.b;a.i=this.i;a.h=K(this.h);a.a=Ad(this.a)||[];a.c=K(this.c);return a};
function Ed(){this.a=this.b=null}Ed.prototype.clone=function(){var a=new Ed;a.b=Ad(this.b);a.a=K(this.a);return a};function Fd(){this.a=1;this.b=this.i=null;this.j=1;this.c=this.g=this.f=this.h=null}Fd.prototype.clone=function(){var a=new Fd;a.a=this.a;a.i=this.i;a.b=this.b;a.j=this.j;a.h=this.h;a.f=this.f;a.g=this.g;a.c=K(this.c);return a};function Gd(){this.a=[]}Gd.prototype.clone=function(){var a=new Gd;a.a=Ad(this.a)||[];return a};function Hd(){this.b=this.a=this.startTime=null}
Hd.prototype.clone=function(){var a=new Hd;a.startTime=this.startTime;a.a=this.a;a.b=this.b;return a};function Id(a,b){this.pa=a;this.end=b}Id.prototype.clone=function(){return new Id(this.pa,this.end)};pd.TAG_NAME="MPD";qd.TAG_NAME="Period";rd.TAG_NAME="AdaptationSet";sd.TAG_NAME="Role";td.TAG_NAME="ContentComponent";ud.TAG_NAME="Representation";vd.TAG_NAME="ContentProtection";wd.TAG_NAME="cenc:pssh";xd.TAG_NAME="BaseURL";yd.TAG_NAME="Location";zd.TAG_NAME="SegmentBase";Bd.TAG_NAME="RepresentationIndex";
Cd.TAG_NAME="Initialization";Dd.TAG_NAME="SegmentList";Ed.TAG_NAME="SegmentURL";Fd.TAG_NAME="SegmentTemplate";Gd.TAG_NAME="SegmentTimeline";Hd.TAG_NAME="S";
pd.prototype.parse=function(a,b){this.url=a.kb;this.id=M(b,"id",N);this.type=M(b,"type",N)||"static";this.b=M(b,"mediaPresentationDuration",Jd);this.h=M(b,"minBufferTime",Jd,this.h);this.g=M(b,"minimumUpdatePeriod",Jd,this.g);this.c=M(b,"availabilityStartTime",Kd,this.c);this.f=M(b,"timeShiftBufferDepth",Jd,this.f);this.i=M(b,"suggestedPresentationDelay",Jd,this.i);var c=a.u,d=O(this,b,xd);this.u=Ld(c,d);if(d=P(this,b,yd))this.j=Md(c,d.url);this.a=O(this,b,qd)};
qd.prototype.parse=function(a,b){this.id=M(b,"id",N);this.start=M(b,"start",Jd);this.a=M(b,"duration",Jd);var c=O(this,b,xd);this.u=Ld(a.u,c);this.c=P(this,b,zd);this.f=P(this,b,Dd);this.w=P(this,b,Fd);this.b=O(this,b,rd);Nd(this)};function Nd(a){for(var b=[],c=0;c<a.b.length;++c){var d=a.b[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.b.length;++c)if(d=a.b[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
rd.prototype.parse=function(a,b){var c=P(this,b,td)||{},d=P(this,b,sd);this.id=M(b,"id",N);this.group=M(b,"group",Q);this.lang=M(b,"lang",N,c.lang);this.contentType=M(b,"contentType",N,c.contentType);this.width=M(b,"width",R);this.height=M(b,"height",R);this.b=M(b,"mimeType",N);this.h=M(b,"codecs",N);this.c=d&&"main"==d.value;this.lang&&(this.lang=lb(this.lang));c=O(this,b,xd);this.u=Ld(a.u,c);this.i=O(this,b,vd);!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]);this.f=a.c?Od(this,
b,a.c):P(this,b,zd);this.g=a.f?Od(this,b,a.f):P(this,b,Dd);this.w=a.w?Od(this,b,a.w):P(this,b,Fd);this.a=O(this,b,ud);!this.b&&this.a.length&&(this.b=this.a[0].c,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))};sd.prototype.parse=function(a,b){this.value=M(b,"value",N)};td.prototype.parse=function(a,b){this.id=M(b,"id",N);this.lang=M(b,"lang",N);this.contentType=M(b,"contentType",N);this.lang&&(this.lang=lb(this.lang))};
ud.prototype.parse=function(a,b){this.id=M(b,"id",N);this.bandwidth=M(b,"bandwidth",R);this.width=M(b,"width",R,a.width);this.height=M(b,"height",R,a.height);this.c=M(b,"mimeType",N,a.b);this.g=M(b,"codecs",N,a.h);this.lang=a.lang;var c=O(this,b,xd);this.u=Ld(a.u,c);this.b=O(this,b,vd);this.f=a.f?Od(this,b,a.f):P(this,b,zd);this.a=a.g?Od(this,b,a.g):P(this,b,Dd);this.w=a.w?Od(this,b,a.w):P(this,b,Fd);this.b=this.b.concat(a.i)};
vd.prototype.parse=function(a,b){this.f=b;this.c=M(b,"schemeIdUri",N);var c=M(b,"cenc:default_KID",N);c&&(this.b=c.replace(/[-]/g,""));this.a=P(this,b,wd)};wd.prototype.parse=function(a,b){var c=Pd(b);if(c){this.psshBox=jc(c);try{this.parsedPssh=new Bc(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};xd.prototype.parse=function(a,b){this.url=Pd(b)};yd.prototype.parse=function(a,b){this.url=Pd(b)};
zd.prototype.parse=function(a,b){this.u=a.u||this.u;this.g=M(b,"timescale",R,this.g);this.f=M(b,"presentationTimeOffset",Q,this.f);this.a=M(b,"indexRange",Qd,this.a);this.b=P(this,b,Bd)||this.b;this.c=P(this,b,Cd)||this.c};Bd.prototype.parse=function(a,b){var c=M(b,"sourceURL",N);this.url=Md(a.u,c);this.a=M(b,"range",Qd,K(a.a))};Cd.prototype.parse=function(a,b){var c=M(b,"sourceURL",N);this.url=Md(a.u,c);this.a=M(b,"range",Qd)};
Dd.prototype.parse=function(a,b){this.u=a.u||this.u;this.f=M(b,"timescale",R,this.f);this.g=M(b,"presentationTimeOffset",Q,this.g);this.b=M(b,"duration",R,this.b);var c=M(b,"startNumber",R);null!=c&&(this.i=c);this.h=P(this,b,Cd)||this.h;this.a=(c=O(this,b,Ed))&&0<c.length?c:this.a;this.c=P(this,b,Gd)||this.c};Ed.prototype.parse=function(a,b){var c=M(b,"media",N);this.b=Md(a.u,c);this.a=M(b,"mediaRange",Qd)};
Fd.prototype.parse=function(a,b){this.a=M(b,"timescale",R,this.a);this.i=M(b,"presentationTimeOffset",Q,this.i);this.b=M(b,"duration",R,this.b);var c=M(b,"startNumber",Q);null!=c&&(this.j=c);this.h=M(b,"media",N,this.h);this.f=M(b,"index",N,this.f);this.g=M(b,"initialization",N,this.g);this.c=P(this,b,Gd)||this.c};Gd.prototype.parse=function(a,b){this.a=O(this,b,Hd)};Hd.prototype.parse=function(a,b){this.startTime=M(b,"t",Q);this.a=M(b,"d",Q);this.b=M(b,"r",Rd)};
function Ld(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new J(e)):(e=Md(a.slice(0,1),e),c.push(e[0]))}return c}function Md(a,b){if(!b)return a;var c=new J(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Od(a,b,c){var d=K(c);(b=Sd(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function P(a,b,c){var d=null;if(b=Sd(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}
function Sd(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function O(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Pd(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function Ad(a){return a?a.map(function(a){return a.clone()}):null}function K(a){return a?a.clone():null}
function M(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function Kd(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Jd(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=Q(b[1]);c&&(a+=31536E3*c);(c=Q(b[2]))&&(a+=2592E3*c);(c=Q(b[3]))&&(a+=86400*c);(c=Q(b[4]))&&(a+=3600*c);(c=Q(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Qd(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=Q(b[1]);if(null==a)return null;b=Q(b[2]);return null==b?null:new Id(a,b)}function Rd(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function R(a){a=window.parseInt(a,10);return 0<a?a:null}function Q(a){a=window.parseInt(a,10);return 0<=a?a:null}function N(a){return a};function Td(a,b){this.url=a;this.b=b||new ac;this.g=this.i=this.h=0;this.a=null;this.c=new F;this.f=null}function ac(){this.body=null;this.a=1;this.g=1E3;this.b=0;this.method="GET";this.f="arraybuffer";this.c={};this.h=this.j=!1;this.i=null}var Ud=!0;function Vd(a){Wd(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}function Wd(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}m=Td.prototype;
m.tb=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.f&&(b=ic(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);Vd(this);return b}if(0==this.url.lastIndexOf("idb:",0))return Xd(this);this.h++;this.i=Date.now();this.g||
(this.g=this.b.g);this.a=new XMLHttpRequest;a=this.url;Ud&&(this.f&&!this.f.supportsCaching()||this.b.h)&&(a=new J(a),od(a.a,"_",Date.now()),a=a.toString());this.a.open(this.b.method,a,!0);this.a.responseType=this.b.f;this.a.timeout=this.b.b;this.a.withCredentials=this.b.j;this.a.onload=this.Cb.bind(this);this.b.h&&(this.a.onreadystatechange=this.Jb.bind(this));this.a.onerror=this.Zb.bind(this);this.a.ontimeout=this.Nb.bind(this);for(b in this.b.c)this.a.setRequestHeader(b,this.b.c[b]);this.a.send(this.b.body);
return this.c};function Xd(a){var b=a.url.split("/");return Ub(a.b.i,parseInt(b[2],10),parseInt(b[3],10)).then(H(a,function(a){var b=JSON.parse(JSON.stringify(new XMLHttpRequest));b.response=a;a=this.c;a.resolve(b);Vd(this);return a})).catch(H(a,function(a){Vd(this);return Promise.reject(a)}))}function Yd(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.ub=a.a;return b}
m.Cb=function(a){this.f&&this.f.sample(Date.now()-this.i,a.loaded);200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Vd(this)):this.h<this.b.a?Zd(this):(a=Yd(this,"HTTP error.","net"),this.c.reject(a),Vd(this))};m.Jb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Ta=a-Date.now())}};m.Zb=function(){var a=Yd(this,"Network failure.","net");this.c.reject(a);Vd(this)};
m.Nb=function(){if(this.h<this.b.a)Zd(this);else{var a=Yd(this,"Request timed out.","net");this.c.reject(a);Vd(this)}};function Zd(a){Wd(a);window.setTimeout(a.tb.bind(a),a.g*(1+.5*(2*Math.random()-1)));a.g*=2};function I(a,b,c,d){this.b=b;this.g=c||0;this.i=null!=d?d:null;this.c=this.a=null;this.j=a;this.h=null}function $d(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}function bc(a,b,c){if(a.a)return a.a;b=b||new ac;if(a.g||a.i)b.c.Range="bytes="+(a.g+"-"+(null!=a.i?a.i:""));a.a=ae(a,0,b,c);return a.a}
I.prototype.f=function(){if(this.c){this.a=null;var a=this.c;if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){a.a.abort();var b=Yd(a,"Request aborted.","aborted");a.c.reject(b);Vd(a)}this.h=this.c=null}};
function ae(a,b,c,d){var e=a.b[b].toString();a.j&&(e=a.j(e,c.c)||e);a.c=new Td(e,c);d&&(a.c.f=d);e=a.c.tb().then(H(a,function(a){this.h=this.c=this.a=null;this.h=a.a?new J(a.a):this.b[b];return Promise.resolve(a.response)}));return e=e.catch(H(a,function(a){if(this.a&&b+1<this.b.length)return this.a=ae(this,b+1,c,d);this.a=this.c=null;return Promise.reject(a)}))}I.prototype.clone=function(){return new I(this.j,this.b.map(function(a){return a.clone()}),this.g,this.i)};I.prototype.toString=function(){return this.b[0].toString()};function be(a,b,c){this.a=new ac;this.a.f="text";this.a.a=3;this.a.b=1E3*(null!=b?b:0);this.a.h=!0;this.c=a;this.b=c}function ce(a){var b=a.c,c=a.b;return bc(b,a.a).then(function(a){var e=a;a&&"function"===typeof c&&(e=c(a)||a);var f=e;a=b.b;e=[b.h];a=(f=(new DOMParser).parseFromString(f,"text/xml"))?P({kb:a,u:e},f,pd):null;if(a)return Promise.resolve(a);a=Error("MPD parse failure.");a.type="dash";return Promise.reject(a)})};function de(a,b,c,d){for(var e=b.w,f=[],g=0;g<d;++g){var h=g+c,l=(h-1)*e.b,k=l/e.a,p=(l+e.b)/e.a,h=ee(a,b,e.j+h-1,l);if(!h)return null;f.push(new fe(k,p,h))}return f}function ee(a,b,c,d){if(!b.w)return null;var e=b.w.h;if(!e)return b.u?new I(a,b.u,0,null):null;c=ge(e,b.id,c,b.bandwidth,d);if(!c)return null;b=$d(b.u,c);return new I(a,b,0,null)}
function ge(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new J(a)}catch(g){if(g instanceof URIError)return null;throw g;}}
function he(a,b,c){var d=0;b*=c;a=a.a;c=[];for(var e=0;e<a.length&&a[e].a;++e){var f=a[e].startTime,f=null!=f?f:d,g=a[e].b||0;0>g&&(g=a[e].a,g=e+1===a.length?Math.ceil((a[0].startTime+b-f)/g)-1:Math.ceil((a[e+1].startTime-f)/g)-1);0<c.length&&f!=d&&(c[c.length-1].end=f);for(var h=0;h<=g;++h)d=f+a[e].a,c.push({start:f,end:d}),f=d}return c};function ie(a,b){this.a=a;this.b=b||null}ie.prototype.destroy=function(){this.a&&(this.a.f(),this.a=null);this.b=null};ie.prototype.create=function(){return this.a?bc(this.a):Promise.resolve(this.b)};function fe(a,b,c){this.startTime=a;this.endTime=b;this.url=c}function je(a,b,c){return new fe(b,c,a.url)}function cc(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.endTime||b<d.endTime))return c}return-1}function ke(a,b){return a.map(function(a){return je(a,a.startTime+b,null!=a.endTime?a.endTime+b:null)})};function le(){}
le.prototype.parse=function(a,b,c,d){var e=null;try{a:{var f=[],g=new Ua(a),h=x(g);if(1936286840!=x(g))e=null;else{1==h&&(h=Ya(g));var l=Xa(g);$a(g,3);$a(g,4);var k=x(g);if(0==k)e=null;else{var p,n;0==l?(p=x(g),n=x(g)):(p=Ya(g),n=Ya(g));$a(g,2);var t=g.b.getUint16(g.a,g.c);g.a+=2;a=p;b=b+h+n;for(h=0;h<t;h++){var D=x(g);n=(D&2147483648)>>>31;var l=D&2147483647,w=x(g);x(g);if(1==n){e=null;break a}var v=new I(d,c,b,b+l-1);f.push(new fe(a/k,(a+w)/k,v));a+=w;b+=l}e=f}}}}catch(L){if(!(L instanceof RangeError))throw L;
}return e};function S(a){this.s=a;this.i=0}S.prototype.destroy=function(){this.s=null};m=S.prototype;m.length=function(){return this.s.length};function T(a){if(0==a.s.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.s[0]}m.B=function(){if(0==this.s.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.s[this.s.length-1]};
m.get=function(a){if(0>a||a>=this.s.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.s[a]};m.find=function(a){a=cc(this.s,a);return 0<=a?this.s[a]:null};m.Ja=function(a){me(this,a);return!0};
function me(a,b){a.i!=b.i&&(b=new S(ke(b.s,a.i-b.i)));if(0==a.length())a.s=b.s.slice(0);else if(0!=b.length()&&null!=a.B().endTime&&!(null!=b.B().endTime&&b.B().endTime<a.B().endTime)){if(a.B().endTime<=T(b).startTime)var c=je(a.B(),a.B().startTime,T(b).startTime),c=a.s.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.s.length&&!(a.s[d].endTime>=T(b).startTime);++d);a.s[d].startTime<T(b).startTime?(c=je(a.s[d],a.s[d].startTime,T(b).startTime),c=a.s.slice(0,d).concat([c])):(T(a).startTime>T(b).startTime||
T(b),c=a.s.slice(0,d))}a.s=c.concat(b.s)}}m.ma=function(a){var b=a-this.i;if(0==b)return 0;this.s=ke(this.s,b);this.i=a;return b};m.Ga=function(){return 0<this.length()?{start:T(this).startTime,end:this.B().endTime}:{start:0,end:0}};function U(a,b,c,d){S.call(this,a);this.g=b;this.v=c;this.f=d;this.h=this.g.b||this.g.a.reduce(function(a,b){return null==b.a?NaN:a+b.a},0)||0;this.a=this.o=this.c=null;ne(this)}r(U,S);U.prototype.destroy=function(){this.v=this.g=null;S.prototype.destroy.call(this)};U.prototype.find=function(a){oe(this,Sa()/1E3);return S.prototype.find.call(this,a)};U.prototype.Ja=function(a){if(!(a instanceof U))return!1;me(this,a);this.h=Math.max(this.h,a.h);null==this.c?(this.f=a.f,ne(this)):pe(this);return!0};
function ne(a){pe(a);if(0!=a.length()){a.length();var b=null!=a.B().endTime?a.B().endTime:a.B().startTime;if(a.g.c>a.f)a.c=b;else{var c=a.f-(a.g.c+a.v.start);0>c?a.c=b:c<Math.max(a.B().startTime,a.B().endTime||0)?(a.B(),a.c=b):a.c=c}a.o=a.B().startTime;a.a=T(a).startTime}}U.prototype.ma=function(a){a=S.prototype.ma.call(this,a);Math.min.apply(null,this.s.filter(function(a){return null!=a.endTime}).map(function(a){return a.endTime-a.startTime}));null!=this.c&&(this.o+=a,this.a+=a,this.c+=a);return a};
U.prototype.Ga=function(){return Ae(this,Sa()/1E3)};function Ae(a,b){oe(a,b);if(null==a.c||null==a.o||null==a.a)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.h&&(c=a.h);var d=b-a.f,e=a.c+d;null!=a.g.f&&(e=e-a.a-a.g.f,0<e&&(a.a+=e));a.a=Math.min(a.a,c);d=a.o+d;if(d<a.a)return{start:a.a,end:a.a};d=0<a.length()?null!=a.B().endTime?Math.min(d,a.B().endTime):d:a.a;d=Math.max(d,a.a);d=Math.min(d,c);return{start:a.a,end:d}}
function oe(a,b){pe(a);if(null!=a.g.f)if(null==a.c)a.length();else{for(var c=a.c+(b-a.f),d=0,e=0;e<a.s.length;++e){var f=null;e<a.s.length-1?f=a.s[e+1].endTime:(f=a.s[e],f=null!=f.endTime?f.endTime+(f.endTime-f.startTime):null);if(null!=f&&f<c-a.g.f)++d;else break}0<d&&a.s.splice(0,d)}}function pe(a){if(a.h){for(var b=0,c=a.s.length-1;0<=c;--c)if(a.s[c].startTime>a.h)++b;else break;0<b&&a.s.splice(-b)}};function Be(a,b,c,d,e){var f=1,g=0,h;if(a.c>d)h=null;else{var l=a.i||0,k=a.f||0;h=c.w;h=h.b/h.a;var p=d-(a.c+b.start);0>p?h=null:(k=p-2*h-k,0>k&&(k=0),k=Math.ceil(k/h)*h,p-=h,0>p?h=null:(l=Math.floor(p/h)*h-l,0>l&&(l=0),l=Math.floor(l/h)*h,h={cb:Ce||k/h+1,current:(l>=k?l:k)/h+1}))}h&&(f=h.cb,g=h.current-h.cb+1);f=Ce||f;f=de(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;U.call(this,f,a,b,d);this.F=c;this.l=this.b=0<this.length()?a.c+b.start+this.B().endTime:
null;this.j=h?h.current+1:null;this.A=e}r(Be,U);Be.prototype.destroy=function(){this.A=this.F=null;U.prototype.destroy.call(this)};Be.prototype.find=function(a){var b=Sa()/1E3;De(this,b);oe(this,b);return S.prototype.find.call(this,a)};Be.prototype.Ja=function(a){if(null!=this.b||!(a instanceof Be)||null==a.b)return!1;this.b=a.b;this.l=a.l;this.j=a.j;this.f=a.f;this.h=a.h;me(this,a);De(this,Sa()/1E3);ne(this);return!0};
Be.prototype.ma=function(a){a=U.prototype.ma.call(this,a);null!=this.b&&(this.b+=a,this.l+=a);return a};Be.prototype.Ga=function(){var a=Sa()/1E3;De(this,a);return Ae(this,a)};function De(a,b){if(null!=a.b&&null!=a.l&&null!=a.j){var c=a.F.w,c=c.b/c.a,d=Math.floor((a.l+(b-a.f)-a.b)/c);if(0!=d){var e=de(a.A,a.F,a.j,d);Array.prototype.push.apply(a.s,ke(e,a.i));a.b+=d*c;a.j+=d}}}var Ce=1;function Ee(a,b,c,d,e){this.c=a;this.b=b;this.F=c;this.g=d;this.a=null;this.f=e}Ee.prototype.destroy=function(){this.f=this.F=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
Ee.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.c.type)try{this.a=new Be(this.c,this.b,this.F,this.g,this.f)}catch(a){return Promise.reject(a)}else{var b;b=this.F.w;if(b=de(this.f,this.F,1,Math.ceil(this.b.a/(b.b/b.a)))){if(0<b.length){var c=b[b.length-1];b[b.length-1]=je(c,c.startTime,this.b.a)}b=new S(b)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function Fe(a,b,c,d,e){this.c=a;this.b=b;this.F=c;this.a=null;this.g=d;this.f=e}Fe.prototype.destroy=function(){this.f=this.F=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
Fe.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.F.a,b=[];a.c&&(b=he(a.c,a.f||1,this.b.a||0));var c=0;a.b&&a.i?c=(a.i-1)*a.b:0<b.length&&(c=b[0].start-(a.g||0));var d=a.a.length;0<b.length&&b.length!=a.a.length&&(d=Math.min(b.length,a.a.length));for(var e=[],f=0;f<d;++f){var g=a.a[f],h=c/a.f,l=null,k=null;a.b?(l=c+a.b,k=l/a.f):0<b.length?(l=b[f].end-(a.g||0),k=l/a.f):(k=h+this.b.a,l=k*a.f);var c=l,l=0,p=null;g.a&&(l=g.a.pa,p=g.a.end);e.push(new fe(h,k,new I(this.f,
g.b,l,p)))}"dynamic"==this.c.type?this.a=new U(e,this.c,this.b,this.g):this.a=new S(e);return Promise.resolve(this.a)};function Ge(a,b,c,d,e){this.b=a;this.c=b;this.F=c;this.g=d;this.a=null;this.f=e}Ge.prototype.destroy=function(){this.f=this.F=this.c=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
Ge.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=this.F.w,b=he(a.c,a.a||1,this.c.a||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=e/a.a,g=b[d].end/a.a,e=ee(this.f,this.F,d+a.j,e);if(!e)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var h=(a.i||0)/a.a;c.push(new fe(f-h,g-h,e))}"dynamic"==this.b.type?this.a=new U(c,this.b,this.c,this.g):this.a=new S(c);return Promise.resolve(this.a)};function He(a){this.b=a;this.a=null}He.prototype.destroy=function(){this.b=null;this.a&&(this.a.destroy(),this.a=null)};He.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=[],b=0;b<this.b.length;++b){var c=this.b[b];a.push(new fe(c.start_time,c.end_time,new I(null,[new J(c.url)],c.start_byte,null)))}this.b=null;this.a=new S(a);return Promise.resolve(this.a)};function Ie(){this.G=Je++;this.id=this.I=this.C=null;this.c=0;this.height=this.width=this.bandwidth=null;this.b=this.a="";this.f=[];this.N=!1;this.K=!0}var Je=0;Ie.prototype.destroy=function(){this.C&&(this.C.destroy(),this.C=null);this.I&&(this.I.destroy(),this.I=null)};function Ke(a){var b=a.a||"";a.b&&(b+='; codecs="'+a.b+'"');return b}function Le(){this.G=Me++;this.id=null;this.contentType=this.lang="";this.b=!1;this.m=[];this.a=[]}var Me=0;
Le.prototype.destroy=function(){for(var a=0;a<this.m.length;++a)this.m[a].destroy();this.a=this.m=null};function Ne(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Oe;d.id=a.G;d.a=a.a[c];d.contentType=a.contentType;d.b=a.m.length?Ke(a.m[0]):"";b.push(d)}return b}function Pe(){this.id=null;this.start=0;this.b=null;this.a=[]}Pe.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Qe(){this.b=!1;this.h=this.g=this.f=null;this.c=0;this.a=[]}
Qe.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Oe(){this.id=0;this.a=null;this.b=this.contentType=""};function Re(a,b,c){E.call(this,a);this.i=b;this.c=!0;this.h=this.a=null;this.b=new Rc(b,c);this.g=null;this.j=new F;this.f=!1;this.l=null}r(Re,E);Re.prototype.destroy=function(){};m=Re.prototype;m.ia=function(){return this.a};m.Ha=function(){return this.h};m.Ta=function(){return this.j};m.ya=function(){return!0};
m.Vb=function(){this.g=null;var a=this.h,b=this.i.currentTime;25<=Tc(this.b,b)?Se(this,1E3/(Math.abs(this.i.playbackRate)||1)):(Te(this,this.a,this.c),(a=Ue(this,b,a))?Vc(this.b,a,this.a).then(H(this,function(a){null==this.l&&(this.l=a);Se(this,0)})).catch(H(this,function(a){if("aborted"!=a.type){var b=z(a);this.dispatchEvent(b);b=[0,404,410];"net"==a.type&&-1!=b.indexOf(a.ub.status)&&Se(this,5E3)}})):Se(this,1E3))};
m.oa=function(a){a==this.a?Te(this,this.a,this.c):a.C.create().then(H(this,function(b){var c=this.a;this.a=a;this.h=b;Te(this,this.a,this.c);Te(this,c,!1);this.f||(c||(this.j.resolve(0),Se(this,0)),Ve(this,!0))})).catch(H(this,function(a){"aborted"!=a.type&&(a=z(a),this.dispatchEvent(a))}))};m.La=function(){return Ve(this,!1)};m.qa=function(a){this.c=a;Te(this,this.a,this.c)};function Te(a,b,c){ad(a.b,b&&b.id||"undefined",c)}m.wa=function(){return this.c};m.Qa=function(a){return 0<Tc(this.b,a)};
function Ve(a,b){a.a&&!a.f&&(a.f=!0,We(a),Sc(a.b).then(H(a,function(){var a=this.i.currentTime;return!b&&0<Tc(this.b,a)&&0<=cc(this.b.b,a)?Promise.resolve():Xc(this.b)})).then(H(a,function(){this.f=!1;Se(this,0)})).catch(H(a,function(a){this.f=!1;a=z(a);this.dispatchEvent(a)})))}m.za=function(){};function Se(a,b){a.g=window.setTimeout(a.Vb.bind(a),b)}function We(a){null!=a.g&&(window.clearTimeout(a.g),a.g=null)}
function Ue(a,b,c){a=a.b;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.endTime?c.find(a.endTime):null:c.find(b)};function Xe(a,b,c,d,e){E.call(this,a);this.c=b;this.a=new Vb(c,d,e);this.v=this.H=this.b=null;this.J=!1;this.g=null;this.l=!1;this.i=null;this.o=!1;this.h=new F;this.j=this.f=!1;this.A=0;this.L=15;this.D=!1}r(Xe,E);Xe.prototype.za=function(a){null!=a.initialStreamBufferSize&&(this.A=Number(a.initialStreamBufferSize));null!=a.streamBufferSize&&(this.L=Number(a.streamBufferSize));null!=a.segmentRequestTimeout&&(this.a.v=Number(a.segmentRequestTimeout))};
Xe.prototype.destroy=function(){Ye(this);this.h.destroy();this.b=this.h=null;this.a.destroy();this.parent=this.c=this.a=null};m=Xe.prototype;m.ia=function(){return this.b};m.Ha=function(){return this.H};m.Ta=function(a){this.f||a.then(function(){this.f=!0;this.g||Ze(this,0)}.bind(this)).catch(function(){});return this.h};m.ya=function(){return this.j};
m.oa=function(a,b,c){if(a!=this.b){var d=[a.C.create(),a.I.create()];Promise.all(d).then(H(this,function(d){if(this.c){var f=this.b;this.b=a;this.H=d[0];this.v=d[1];this.J=!0;this.l||(f?b&&$e(this,!0,c):Ze(this,0))}})).catch(H(this,function(a){"aborted"!=a.type&&(this.f?(a=z(a),this.dispatchEvent(a)):this.h.reject(a))}))}};m.La=function(){return $e(this,!1)};
function $e(a,b,c){a.b&&!a.l&&(a.l=!0,Ye(a),Xb(a.a).then(H(a,function(){var a=this.c.currentTime;if(!b&&0<Yb(this.a,a)&&0<=cc(this.a.b,a))return Promise.resolve();if(c)return fc(this.a,this.c.currentTime+c);this.D=!0;return ec(this.a)})).then(H(a,function(){this.l=!1;Ze(this,0)})).catch(H(a,function(a){this.l=!1;this.f?(a=z(a),this.dispatchEvent(a)):this.h.reject(a)})))}m.Qa=function(a){return 0<Yb(this.a,a)&&0<=cc(this.a.b,a)};m.qa=function(){};m.wa=function(){return!0};
m.Wb=function(){if(this.o&&!this.f)this.g=null;else{var a;if(a=this.f&&!this.j)a=1<this.a.c.buffered.length?!0:!1;if(a)$e(this,!0);else{this.g=null;a=this.b;var b=this.H,c=this.c.currentTime;Yb(this.a,this.o?c:c+(this.i||0))>=(this.o?Math.max(this.A,this.L):this.A)?(af(this),Ze(this,1E3/(Math.abs(this.c.playbackRate)||1))):(b=bf(this,c,b))?(b=Zb(this.a,b,a.c,this.v),this.v=null,this.J&&(this.J=!1,cf(this,a)),this.j=!1,b.then(H(this,function(a){null==this.i&&(this.i=a);this.D&&0<Yb(this.a,c)&&(this.D=
!1,this.c.currentTime+=.001);Ze(this,0)})).catch(H(this,function(a){if("aborted"!=a.type){var b=[0,404,410];"net"==a.type&&-1!=b.indexOf(a.ub.status)&&this.b&&Ze(this,5E3);a=z(a);this.dispatchEvent(a)}}))):(af(this),this.f&&!this.j&&(this.j=!0,df(this)),Ze(this,1E3))}}};function bf(a,b,c){a=a.a;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.endTime?c.find(a.endTime):null:c.find(b)||(c.length()?c.B():null)}
function af(a){if(!a.o&&null!=a.i){a.o=!0;var b=a.a,c=a.i,d=c-b.A;0!=d&&(b.b=ke(b.b,d),b.A=c);a.h.resolve(a.i)}}function cf(a,b){var c;c=b.a.split("/")[0];c=y({type:"adaptation",bubbles:!0,contentType:c,size:"video"!=c?null:{width:b.width,height:b.height},bandwidth:b.bandwidth});a.dispatchEvent(c)}function df(a){var b=y({type:"ended"});a.dispatchEvent(b)}function Ze(a,b){a.g=window.setTimeout(a.Wb.bind(a),b)}function Ye(a){null!=a.g&&(window.clearTimeout(a.g),a.g=null)};function ef(a){this.b=a;this.a=null}ef.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};ef.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new fe(0,null,this.b);this.a=new S([a]);return Promise.resolve(this.a)};function ff(a,b){E.call(this,a);this.b=b;this.g=!0;this.h=this.f=null;this.c=new F;this.a=null}r(ff,E);ff.prototype.za=function(){};ff.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.c.destroy();this.parent=this.b=this.f=this.h=this.a=this.c=null};m=ff.prototype;m.ia=function(){return this.f};m.Ha=function(){return this.h};m.Ta=function(){return this.c};m.ya=function(){return!0};
m.oa=function(a){a.C.create().then(H(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.f;this.f=a;this.h=b;b=T(b).url.b[0].toString();var d=this.wa();this.a&&(this.qa(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.qa(d);b=y({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.c.resolve(0)}}))};m.La=function(){};
m.Qa=function(){return!0};m.qa=function(a){this.g=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};m.wa=function(){this.a&&(this.g="showing"==this.a.track.mode);return this.g};function gf(){}
gf.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new ab(b);if(440786851!=cb(g).id)f=null;else{var h=cb(g);if(408125543!=h.id)f=null;else{var l=h.a.byteOffset,k;var p=new ab(h.a);for(b=null;Wa(p.a);){var n=cb(p);if(357149030==n.id){b=n;break}}if(b){for(var t=new ab(b.a),p=1E6;Wa(t.a);){var D=cb(t);if(2807729==D.id){p=gb(D);break}}k=p/1E9}else k=null;f=k?{Ub:l,bc:k}:null}}if(f){var w=cb(new ab(a));if(475249515!=w.id)e=null;else{var v=f.Ub,L=f.bc;a=[];var qe=new ab(w.a);for(f=w=-1;Wa(qe.a);){var re=
cb(qe);if(187==re.id){var Ma;var se=new ab(re.a),te=cb(se);if(179!=te.id)Ma=null;else{var Xf=gb(te),ue=cb(se);if(183!=ue.id)Ma=null;else{for(var ve=new ab(ue.a),l=0;Wa(ve.a);){var we=cb(ve);if(241==we.id){l=gb(we);break}}Ma={ec:Xf,Tb:l}}}if(Ma){var xe=L*Ma.ec,ye=v+Ma.Tb;if(0<=w){var Zc=new I(d,c,f,ye-1);a.push(new fe(w,xe,Zc))}w=xe;f=ye}}}0<=w&&(Zc=new I(d,c,f,null),a.push(new fe(w,null,Zc)));e=a}}else e=null}catch(ze){if(!(ze instanceof RangeError))throw ze;}return e};function hf(a,b,c,d,e,f,g){this.g=a;this.i=b;this.f=c;this.a=d;this.c=e;this.j=f;this.b=null;this.h=g}hf.prototype.destroy=function(){this.h=this.i=this.g=null;this.a.f();this.a=null;this.c&&(this.c.f(),this.c=null);this.b=null};
hf.prototype.create=function(){if(this.b)return this.b;var a=[bc(this.a)];"webm"==this.f&&a.push(bc(this.c));return this.b=Promise.all(a).then(H(this,function(a){var c=a[0];a=a[1]||null;var d=null;"mp4"==this.f?(d=new le,d=d.parse(new DataView(c),this.a.g,this.a.b,this.h)):"webm"==this.f&&(d=new gf,d=d.parse(new DataView(c),new DataView(a),this.a.b,this.h));if(!d)return c=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);
var e;"dynamic"==this.g.type?e=new U(d,this.g,this.i,this.j):e=new S(d);return Promise.resolve(e)}))};function jf(a){this.a=a}
function kf(a,b,c){for(var d=Sa()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.b.length;++g){var h=f.b[g];if("text"!=h.contentType)for(var l=0;l<h.a.length;++l){var k=h.a[l],p=0,p=p+(k.f?1:0),p=p+(k.a?1:0),p=p+(k.w?1:0);0==p?(h.a.splice(l,1),--l):1!=p&&(k.f?(k.a=null,k.w=null):k.a&&(k.w=null))}}lf(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.b.length;++g){l=h=f.b[g];k=null;for(p=0;p<l.a.length;++p){var n=l.a[p].c||"";k?n!=k&&(l.a.splice(p,1),--p):k=n}0==h.a.length&&(f.b.splice(g,1),--g)}"dynamic"==
b.type&&null==b.c&&(b.c=d);e=new Qe;"dynamic"==b.type&&(e.b=!0,e.f=b.g,e.g=new I(c,b.j||b.url),e.h=b.c);e.c=b.h||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start)break;g=mf(a,b,g,d,c);e.a.push(g)}return e}
function lf(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].a)&&(a.a[0].a=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.b};!b(g.start)&&f&&b(f.start)&&b(f.a)&&(g.start=f.start+f.a);!b(g.a)&&b(h.start)&&(g.a=h.start-g.start);null!=g.start&&null!=g.a?c+=g.a:d=!1}b(a.b)||(e=a.a[a.a.length-1],d?a.b=c:b(e.start)&&b(e.a)?a.b=e.start+e.a:"dynamic"!=a.type&&
(a.b=c))}}function mf(a,b,c,d,e){var f=new Pe;f.id=c.id;f.start=c.start;f.b=c.a;var g=new A;c.b.forEach(function(a){g.push(a.contentType||"",a)});for(var h=xb(g),l=0;l<h.length;++l){var k=new A;g.get(h[l]).forEach(function(a){k.push(a.group,a)});for(var p=xb(k),n=0;n<p.length;++n){var t=new A;k.get(p[n]).forEach(function(a){t.push(a.lang,a)});for(var D=xb(t),w=0;w<D.length;++w){var v=t.get(D[w]),v=nf(a,b,c,v,d,e);f.a.push(v)}}}return f}
function nf(a,b,c,d,e,f){ba(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new Le,h=d.filter(function(a){return null!=a.id});h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.b=d.some(function(a){return a.c});for(var h={},l=0;l<d.length;++l)for(var k=d[l],p=0;p<k.a.length;++p){var n=k.a[p],t=of(a,n),D=g.a.slice(0);
pf(t,D);0==D.length&&0<g.a.length||!(n=qf(b,c,n,e,f))||(g.m.push(n),g.a=D,h[n.G]=k)}if(g.a.some(function(a){return""==a.a}))return g.m.forEach(function(a){a.N=!0}),g;a=rf(d);for(l=0;l<g.m.length;++l)n=g.m[l],k=h[n.G],k==a&&(n.N=!0);return g}function rf(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var g=e.a[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}
function pf(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],g=a[e];if(f.a==g.a&&f.h==g.h&&f.i==g.i&&f.g==g.g&&f.l==g.l&&f.f==g.f&&f.j==g.j&&eb(f.c,g.c)){d=!0;oc(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}function of(a,b){var c=[];if(0==b.b.length)c.push(new lc);else if(a.a)for(var d=0;d<b.b.length;++d)c.push.apply(c,sf(a,b.b[d]));return c}
function sf(a,b){var c=[];if(2!=a.a.length)return[];var d=a.a(b.c||"",b.f);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f=mc(d[e]);0==f.b.length&&b.a&&b.a.psshBox&&oc(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function qf(a,b,c,d,e){if(!c.u||0===c.u.length)return null;var f=null,g=1,h=0;if(c.f)f=c.c.split("/")[1],"mp4"!=f&&"webm"!=f?f=null:(g=c.f,"webm"!=f||g.c?g.a||g.b&&g.b.a?(h=g.b,h||(h=new Bd,h.url=c.u,h.a=g.a?g.a.clone():null),h=tf(h,e),g=g.c?tf(g.c,e):null,a=new hf(a,b,f,h,g,d,e),b=new ie(g),d=new Ie,d.C=a,d.I=b,f=d):f=null:f=null),g=c.f.g,h=c.f.f;else if(c.a)f=c.a,!f.b&&!f.c&&1<f.a.length?f=null:f.b||b.a||f.c||1!=f.a.length?f.c&&0===f.c.a.length?f=null:(f=f.h?tf(f.h,e):null,a=new Fe(a,b,c,d,e),b=
new ie(f),d=new Ie,d.C=a,d.I=b,f=d):f=null,g=c.a.f,h=c.a.g;else if(c.w){a:if(f=c.w,g=0+(f.f?1:0),g+=f.c?1:0,g+=f.b?1:0,0==g?g=!1:(1!=g&&(f.f?(f.c=null,f.b=null):f.c&&(f.b=null)),g=!0),g){g=null;if(f.g&&(g=(f=c.w.g)?uf(c,f,Cd):null,!g)){f=null;break a}f=g?tf(g,e):null;g=c.w;g.f?(g=c.c.split("/")[1],"mp4"!=g&&"webm"!=g?a=null:"webm"!=g||f?ee(e,c,1,0)?(h=(h=c.w.f)?uf(c,h,Bd):null)?(h=tf(h,e),a=new hf(a,b,g,h,f,d,e)):a=null:a=null:a=null):a=g.h?g.c?new Ge(a,b,c,d,e):g.b?"dynamic"!=a.type&&null==b.a?null:
new Ee(a,b,c,d,e):null:null;a?(b=new ie(f),d=new Ie,d.C=a,d.I=b,f=d):f=null}else f=null;g=c.w.a;h=c.w.i}else"text"==c.c.split("/")[0]&&(f=new Ie,f.C=new ef(new I(e,c.u)));if(!f)return null;f.id=c.id;h&&(f.c=-1*h/g);f.bandwidth=c.bandwidth;f.width=c.width;f.height=c.height;f.a=c.c||"";f.b=c.g||"";for(a=0;a<c.b.length;++a)b=c.b[a],b.b&&f.f.push(b.b);return f}function uf(a,b,c){b=ge(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=$d(a.u,b);return c}
function tf(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.pa,e=a.a.end);return new I(b,c,d,e)};function vf(){this.streamStats=null;this.droppedFrames=this.decodedFrames=NaN;this.bufferingTime=this.playTime=this.estimatedBandwidth=0;this.playbackLatency=NaN;this.bufferingHistory=[];this.bandwidthHistory=[];this.streamHistory=[]}function wf(a,b){var c=new xf(b);a.streamHistory.push(new yf(c));if(c.videoHeight||!a.streamStats)a.streamStats=c}function xf(a){this.videoWidth=a.width;this.videoHeight=a.height;this.videoMimeType=a.a;this.videoBandwidth=a.bandwidth}
function yf(a){this.timestamp=Sa()/1E3;this.value=a};function zf(a,b){Hb.call(this,"readwrite",b);this.j=a;this.b=0}r(zf,Hb);
function Af(a,b,c,d,e){for(var f=[],g=[],h=0,l=0,k=[],p=b.map(function(a){return a.C.create()}),p=Promise.all(p),n=b.map(function(a){return a.I.create()}),n=Promise.all(n),p=Promise.all([p,n]).then(function(a){f=a[0];g=a[1];h=f.reduce(function(a,b){return a+b.length()},0)}),n=0;n<b.length;++n)p=p.then(function(a){return Bf(this,b[a],f[a],g[a],h,l)}.bind(a,n)),p=p.then(function(a,b){l+=f[a].length();k.push(b)}.bind(a,n));return p.then(H(a,function(){return Cf(Ob(this))})).then(H(a,function(a){var b=
new F;c=Ra(c);var f={group_id:a,stream_ids:k,session_ids:c,duration:d,key_system:e.a,license_server:e.h,with_credentials:e.i,distinctive_identifier:e.g,audio_robustness:e.f,video_robustness:e.j},g=Ob(this).put(f);g.onsuccess=function(){b.resolve(a)};g.onerror=function(){b.reject(g.error)};return b}))}function Df(a,b){return Pb(Ob(a),b).then(H(a,function(a){var d=[],e;for(e in a.stream_ids)d.push(Ef(this,a.stream_ids[e]));a=Ob(this);d.push(a.delete(b));return Promise.all(d)}))}
function Bf(a,b,c,d,e,f){var g=[Cf(Nb(a)),Cf(Lb(a).index("stream"))],g=Promise.all(g).then(H(a,function(a){return{sa:Math.max(a[0],a[1]),la:new ArrayBuffer(0),Ma:0,s:[],Fa:null,cc:e,lb:f}})),g=g.then(a.f.bind(a,c));return g=g.then(a.g.bind(a,b,d))}function Cf(a){var b=new F,c=a.openCursor(null,"prev");c.onsuccess=function(a){a.target.result?b.resolve(a.target.result.key+1):b.resolve(0)};c.onerror=function(){b.reject(c.error)};return b}
zf.prototype.g=function(a,b,c){var d=new F;a={stream_id:c.sa,mime_type:a.a,codecs:a.b,init_segment:b,references:c.s};var e=Nb(this).put(a);e.onsuccess=function(){d.resolve(c.sa)};e.onerror=function(){d.reject(e.error)};return d};zf.prototype.f=function(a,b){for(var c=Promise.resolve(),d=0;d<a.length();++d)var e=a.get(d),f=d==a.length()-1,f=this.c.bind(this,e,b,f),c=c.then(this.i.bind(this,e)),c=c.then(f);return c.then(function(){return Promise.resolve(b)}).catch(H(this,function(a){Ef(this,b.sa);return Promise.reject(a)}))};
zf.prototype.c=function(a,b,c,d){var e=new F;0==b.la.byteLength&&(b.Fa=a);b.la=Ff(b.la,d);b.lb++;var f=y({type:"progress",detail:b.lb/b.cc*100,bubbles:!0});if(1048576<=b.la.byteLength||c){c={stream_id:b.sa,segment_id:b.Ma,content:b.la};var g=Lb(this).put(c);b.s.push({start_time:b.Fa.startTime,start_byte:b.Fa.url.g,end_time:a.endTime,url:"idb://"+b.sa+"/"+b.Ma});b.Ma++;b.la=new ArrayBuffer(0);g.onerror=function(){e.reject(g.error)};g.onsuccess=H(this,function(){this.dispatchEvent(f);e.resolve()})}else this.dispatchEvent(f),
e.resolve();return e};function Ff(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);c.set(new Uint8Array(a),0);c.set(new Uint8Array(b),a.byteLength);return c.buffer}zf.prototype.i=function(a){var b=new ac;b.b=1E3*this.b;return bc(a.url,b,this.j)};
function Ef(a,b){var c=new F,d=Nb(a).delete(b);d.onerror=function(){c.reject(d.error)};var e=Lb(a);e.index("stream").openKeyCursor(IDBKeyRange.only(b)).onsuccess=function(a){if(a=a.target.result)e.delete(a.primaryKey),a.continue()};e.transaction.oncomplete=function(){c.resolve()};return c};function Gf(a,b,c,d,e,f){this.b=new I(null,[new J(a)]);this.a=new ac;this.a.body=b;this.a.method=c;this.a.a=3;this.a.j=d;this.a.b=1E3*(null!=f?f:0);a=e||{};for(var g in a)this.a.c[g]=a[g]}function Hf(a){return bc(a.b,a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function If(a,b,c){E.call(this,a);this.h=b;this.b=c;this.a=this.i=null;this.l=new B;this.c=[];this.f=[];this.o=0;this.g=new F;this.j=null;this.v=0}r(If,E);If.prototype.destroy=function(){this.parent=null;for(var a=0;a<this.f.length;++a)this.f[a].close().catch(function(){});this.f=[];this.c=this.a=this.i=null;this.g.destroy();this.g=null;this.l.destroy();this.l=null;this.j&&(window.clearTimeout(this.j),this.j=null);this.h=this.b=null};
If.prototype.initialize=function(){for(var a=new A,b=this.b.fb(),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!Jf(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.g?"required":"optional",persistentState:h.l||this.b.ja()?"required":"optional",sessionTypes:[this.b.ja()?"persistent-license":"temporary"]},
c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",g in h)){d=!0;h[g]||(h[g]=[]);var l;"audio"==f.contentType?l=f.a.f:"video"==f.contentType&&(l=f.a.j);h[g].push({contentType:f.b,robustness:l})}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return this.b.Na(a),this.g.resolve(),Promise.resolve();l=new F;c=Kf(this,c,l);c=c.then(this.D.bind(this,b,a));l.reject(null);return c};
function Lf(a,b){null==a.j&&(a.j=window.setTimeout(function(){var a=Error("Timeout waiting for sessions.");a.type="storage";this.g.reject(a)}.bind(a),b));return a.g}function Mf(a){return Promise.all(a.f.map(function(a){return a.remove()}))}
function Kf(a,b,c){for(var d in b)c=c.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,d,b[d]));a.b.ja()&&(c=c.catch(function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.");}));return c}
If.prototype.D=function(a,b,c){if(!this.h)return Nf();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var l=e[h+"Capabilities"];if(l){for(var l=l[0],k=[],p={},n=0;n<a.length;++n){var t=a[n],D=l?t.b==l.contentType:t.contentType==h;t.a.a!=d||!D||t.id in p||(k.push(t),p[t.id]=!0,this.a=this.a?nc(this.a,t.a):t.a)}b.set(h,k)}}}this.b.Na(b);return c.createMediaKeys().then(function(a){this.i=a}.bind(this))};
function Of(a){return a.h?a.i?a.h.setMediaKeys(a.i).then(H(a,function(){return this.h?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():Nf()})).then(H(a,function(){if(!this.h)return Nf();if(0<this.b.xa().length)Pf(this);else{for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.A({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&C(this.l,this.h,"encrypted",this.A.bind(this))}})):Promise.resolve():Nf()}
function Nf(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
If.prototype.A=function(a){for(var b=new Uint8Array(a.initData),c=0;c<this.c.length;++c)if(eb(b,this.c[c].data))return;try{var d=Qf(this)}catch(e){b=z(e);this.dispatchEvent(b);this.g.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.c.push({data:b,Oa:d});a.catch(H(this,function(a){if(this.h){for(var b=0;b<this.c.length;++b)if(this.c[b].Oa==d){this.c.splice(b,1);break}b=z(a);this.dispatchEvent(b);this.g.reject(a)}}));this.f.push(d)};
function Pf(a){for(var b=a.b.xa(),c=0;c<b.length;++c){var d=Qf(a),e=d.load(b[c]);a.f.push(d);e.then(H(a,function(){this.o++;this.o>=this.f.length&&this.g.resolve()})).catch(H(a,function(a){a=z(a);this.dispatchEvent(a)}))}}
function Qf(a){var b=null;if(a.b.ja())try{b=a.i.createSession("persistent-license")}catch(c){throw Error("Persistent licenses are not supported by this key system or platform.");}else b=a.i.createSession();C(a.l,b,"message",a.J.bind(a));C(a.l,b,"keystatuseschange",a.H.bind(a));return b}If.prototype.J=function(a){Rf(this,a.target,this.a,a.message)};
If.prototype.H=function(a){a=a.target;var b={};a.keyStatuses.forEach(function(a,c){if("string"==typeof a){var f=a;a=c;c=f}if("com.microsoft.playready"==this.a.a&&16==a.byteLength){var f=new DataView(a),g=f.getUint32(0,!0),h=f.getUint16(4,!0),l=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,h,!1);f.setUint16(6,l,!1)}f=kc(new Uint8Array(a));b[f]=c}.bind(this));if(a.expiration<Date.now()){for(var c=0;c<this.c.length;++c)if(this.c[c].Oa==a){this.c.splice(c,1);break}a.close();this.f.splice(this.f.indexOf(a),
1)}this.b.gb(b)};function Rf(a,b,c,d){d=Sf(c,d);Hf(new Gf(d.url,d.body,d.method,c.i,d.headers,a.v)).then(H(a,function(a){c.o&&(a=c.o(a));return b.update(a)})).then(H(a,function(){var a=y({type:"sessionReady",detail:b});this.dispatchEvent(a);this.o++;this.o>=this.f.length&&this.g.resolve()})).catch(H(a,function(a){a.Oa=b;a=z(a);this.dispatchEvent(a)}))}
function Sf(a,b){var c={url:a.h,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.v)return c;a.v(c);c.url=tb(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"==typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=tb(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=ub(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function V(a){E.call(this,null);this.a=a;this.b=null;this.f=new B;this.j=this.i=null;this.D=0;this.v=null;this.h=!1;this.g=new vf;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new ja};this.l=1;this.H=null}r(V,E);q("shaka.player.Player",V);V.version="v1.6.5-dirty";
V.isBrowserSupported=function(){return!!window.MediaSource&&!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration&&!!window.Promise&&!!Element.prototype.requestFullscreen&&!!document.exitFullscreen&&"fullscreenElement"in document&&!!window.Uint8Array};function Jf(a){return"text/vtt"==a||'text/vtt; codecs="vtt"'==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}
V.isTypeSupported=Jf;V.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+pa(a)+" }",0)};V.prototype.destroy=function(){return this.o().then(H(this,function(){this.f.destroy();this.a=this.f=null})).catch(function(){})};V.prototype.destroy=V.prototype.destroy;
V.prototype.o=function(){if(!this.b)return Promise.resolve();this.h&&Tf(this);this.a.pause();yb(this.f);Uf(this);Vf(this);this.i&&(this.i.destroy(),this.i=null);this.a.src="";var a=this.a.setMediaKeys(null);this.b&&(this.b.destroy(),this.b=null);this.h=!1;this.g=new vf;return a};V.prototype.unload=V.prototype.o;
V.prototype.fa=function(a){var b=this.o();this.a.autoplay&&(da("load"),C(this.f,this.a,"timeupdate",this.Bb.bind(this)));a.U(this.c);a.rb(this.H);this.H=null;b=b.then(H(this,function(){return a.Y()}));b.catch(H(this,function(b){a.destroy();return Promise.reject(b)}));return b.then(H(this,function(){if(!this.a)return Wf();this.b=a;C(this.f,this.b,"seekrangechanged",this.Kb.bind(this));this.i=new If(this,this.a,this.b);return this.i.initialize()})).then(H(this,function(){if(!this.a)return Wf();C(this.f,
this.a,"error",this.Xb.bind(this));C(this.f,this.a,"playing",this.Ib.bind(this));C(this.f,this.a,"pause",this.Hb.bind(this));return this.b.mb(this,this.a)})).then(H(this,function(){return this.a?Of(this.i):Wf()})).then(H(this,function(){if(!this.a)return Wf();Yf(this)})).catch(H(this,function(a){if(!this.a)return Wf();if("destroy"!=a.type){var b=z(a);this.dispatchEvent(b)}return this.o().then(function(){return Promise.reject(a)})}))};V.prototype.load=V.prototype.fa;
function Wf(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}m=V.prototype;m.Bb=function(){ga("load");this.g.playbackLatency=ha("load")/1E3;this.f.ta(this.a,"timeupdate")};m.Xb=function(){if(this.a.error){var a=this.a.error.code;a!=MediaError.MEDIA_ERR_ABORTED&&(a=Error(Zf[a]||"Unknown playback error."),a.type="playback",a=z(a),this.dispatchEvent(a))}};
m.Ib=function(){da("playing");!this.j&&0>this.l&&(this.a.playbackRate=0,this.A(this.a.currentTime,Date.now(),this.l));this.h&&Tf(this)};m.Hb=function(){ga("playing");var a=ha("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3}Vf(this)};m.Kb=function(a){this.D=a.start};
m.sb=function(){if(!this.a.paused){ga("playing");var a=ha("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3;da("playing")}}a=this.g;b=this.a;b.getVideoPlaybackQuality&&(b=b.getVideoPlaybackQuality(),a.decodedFrames=b.totalVideoFrames,a.droppedFrames=b.droppedVideoFrames);return this.g};V.prototype.getStats=V.prototype.sb;V.prototype.ea=function(){return this.b?this.b.na():[]};V.prototype.getVideoTracks=V.prototype.ea;V.prototype.Z=function(){return this.b?this.b.ra():[]};
V.prototype.getAudioTracks=V.prototype.Z;V.prototype.aa=function(){return this.b?this.b.Sa():[]};V.prototype.getTextTracks=V.prototype.aa;V.prototype.selectVideoTrack=function(a,b){return this.b?this.b.selectVideoTrack(a,void 0==b?!0:b):!1};V.prototype.selectVideoTrack=V.prototype.selectVideoTrack;V.prototype.M=function(a,b,c){return this.b?this.b.pb(a,void 0==b?!0:b,c):!1};V.prototype.selectAudioTrack=V.prototype.M;V.prototype.ga=function(a){return this.b?this.b.qb(a,!1):!1};
V.prototype.selectTextTrack=V.prototype.ga;V.prototype.W=function(a){this.b&&this.b.Ra(a)};V.prototype.enableTextTrack=V.prototype.W;V.prototype.U=function(a){Vf(this);0<=a?this.a.playbackRate=a:this.a.paused||(this.a.playbackRate=0,this.A(this.a.currentTime,Date.now(),a));this.l=a};V.prototype.setPlaybackRate=V.prototype.U;V.prototype.L=function(){return this.l};V.prototype.getPlaybackRate=V.prototype.L;V.prototype.R=function(a){this.H=a};V.prototype.setPlaybackStartTime=V.prototype.R;
V.prototype.J=function(){return this.b?this.b.ob():!1};V.prototype.isLive=V.prototype.J;
V.prototype.V=function(a){if(a){var b=qb(a,"enableAdaptation");null!=b&&(this.c.enableAdaptation=b);b=sb(a,"streamBufferSize");null!=b&&(this.c.streamBufferSize=b);b=sb(a,"liveStreamEndTimeout");null!=b&&(this.c.liveStreamEndTimeout=b);b=sb(a,"licenseRequestTimeout");null!=b&&(this.c.licenseRequestTimeout=b);b=sb(a,"mpdRequestTimeout");null!=b&&(this.c.mpdRequestTimeout=b);b=sb(a,"segmentRequestTimeout");null!=b&&(this.c.segmentRequestTimeout=b);b=tb(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=
b);b=ub(a,"restrictions",ja);null!=b&&(this.c.restrictions=b.clone());a=qb(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=a&&(Ud=!a);this.b&&this.b.U(this.c)}};V.prototype.configure=V.prototype.V;V.prototype.$=function(){return this.c};V.prototype.getConfiguration=V.prototype.$;function Vf(a){a.j&&(window.clearTimeout(a.j),a.j=null)}function Yf(a){Uf(a);a.v=window.setTimeout(a.T.bind(a),100)}function Uf(a){a.v&&(window.clearTimeout(a.v),a.v=null)}
V.prototype.A=function(a,b,c){this.j=null;var d=(Date.now()-b)/1E3*c;this.a.currentTime<this.D+(this.J()?1:.05)?this.a.pause():(d=Math.max(this.D,a+d),this.a.currentTime=d,this.j=window.setTimeout(this.A.bind(this,a,b,c),250))};function Tf(a){ga("buffering");var b=a.g;b.bufferingTime+=ha("buffering")/1E3;a.h=!1;a.dispatchEvent(y({type:"bufferingEnd"}))}
V.prototype.T=function(){Yf(this);if(!this.a.ended&&!this.a.seeking){var a=this.a.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.a.currentTime,0),c=this.a.duration,c=isNaN(c)?0:Math.max(c-.05,0),b=b>=c||this.a.currentTime>=c;if(this.h){if(c=this.b.nb(),b||a>c)Tf(this),this.a.play()}else!this.a.paused&&!b&&.5>a&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(Sa()/1E3),da("buffering"),this.dispatchEvent(y({type:"bufferingStart"})))}};
var Zf={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function $f(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=0;g<f.m.length;++g)Jf(Ke(f.m[g]))||(f.m.splice(g,1),--g);0==e.m.length&&(c.a.splice(d,1),--d)}}function ag(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d)c.a[d].m.sort(bg)}function bg(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function cg(a){this.a=a}cg.prototype.destroy=function(){this.a.destroy();this.a=null};cg.prototype.update=function(a){var b=dg(a),c=dg(this.a);return Promise.all([b,c]).then(H(this,function(b){var c=b[0];b=b[1];var f=this.a.a;$f(f);ag(f);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;f=[];eg(a,this.a,c,b,f);c=a.a;$f(c);ag(c);return Promise.resolve(f)}))};
function dg(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.m}).reduce(b,[]);a=c.map(function(a){return a.C.create()});return Promise.all(a).then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].G]=a[f];return Promise.resolve(b)})}
function eg(a,b,c,d,e){var f=new A;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new A;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=xb(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&(fg(l[0],h[0],c,d,e),l[0].b=h[0].b)}}
function fg(a,b,c,d,e){var f=new A;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new A;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=xb(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&gg(l[0],h[0],c,d,e)}}
function gg(a,b,c,d,e){var f=new A;a.m.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new A;b.m.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=xb(f),l=0;l<h.length;++l){var k=h[l];b[k]=k;var p=f.get(k);1<p.length||((k=g.get(k))&&0!=k.length?1==k.length&&(hg(p[0],k[0],c,d),p[0].I=k[0].I,k[0].I=null,p[0].c=k[0].c):(e.push(p[0]),a.m.splice(a.m.indexOf(p[0]),1)))}h=xb(g);for(l=0;l<h.length;++l)k=h[l],b[k]||(b[k]=k,k=g.get(k),a.m.push(k[0]))}
function hg(a,b,c,d){a=c[a.G];b=d[b.G];a.length();a.Ja(b)&&a.length()};function W(){this.a=this.b=null;this.f=new B;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}q("shaka.media.SimpleAbrManager",W);W.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};W.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
W.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,C(this.f,this.b,"bandwidth",this.l.bind(this)),C(this.f,this.a,"adaptation",this.j.bind(this)),C(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};W.prototype.enable=function(a){this.i=a};W.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=ig(this);return a?a.id:null};W.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};
W.prototype.l=function(){Date.now()<this.c||this.h()};W.prototype.h=function(){if(this.i){var a=ig(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};W.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function ig(a){var b=a.a.na();if(0==b.length)return null;b.sort(ta);var c;a:{c=a.a.ra();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(g=(g.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=g&&(d=f,d.active)))break}return d};function jg(a,b,c){E.call(this,null);this.f=a;this.c=b;this.b=mc(c);this.a=null}r(jg,E);q("shaka.player.HttpVideoSource",jg);jg.prototype.U=function(){};jg.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null);this.parent=this.b=null};m=jg.prototype;m.mb=function(a,b){this.parent=a;var c=b.mediaKeys;b.src=this.f;c=b.setMediaKeys(c);this.c&&(this.a=document.createElement("track"),this.a.src=this.c,b.appendChild(this.a),this.a.track.mode="showing");return c};
m.Y=function(){return Promise.resolve()};m.na=function(){return[]};m.ra=function(){return[]};m.Sa=function(){return[]};m.nb=function(){return 5};m.fb=function(){var a=new Oe;a.a=this.b;return[a]};m.Na=function(){};jg.prototype.selectVideoTrack=function(){return!1};m=jg.prototype;m.pb=function(){return!1};m.qb=function(){return!1};m.Ra=function(a){this.a&&(this.a.track.mode=a?"showing":"disabled")};m.rb=function(){};m.xa=function(){return[]};m.ja=function(){return!1};m.ob=function(){return!1};
m.gb=function(a){for(var b in a){var c=a[b],d=hb[c]||null;if(d){var e=Cb(b),d=Error("Key "+e+" is not usable. "+d);d.type="drm";d.code=c;c=z(d);this.dispatchEvent(c)}}};function X(a,b,c){E.call(this,null);this.a=a;this.$=b;this.i=new B;this.g=new MediaSource;this.f=null;this.ea=0;this.b=new A;this.J=c;this.J.initialize(b,this);this.T=!1;this.L="en";this.ga=!1;this.V=null;this.A=new F;this.h=new ja;this.D=null;this.$a=1;this.c={};this.fa=new F;this.Ya=0;this.Za=15;this.v=null;this.Wa=this.Xa=!1;this.o={};this.aa=this.Z=this.W=null;this.H={}}r(X,E);q("shaka.player.StreamVideoSource",X);
X.prototype.U=function(a){null!=a.streamBufferSize&&(this.H.streamBufferSize=a.streamBufferSize);null!=a.segmentRequestTimeout&&(this.H.segmentRequestTimeout=a.segmentRequestTimeout);kg(this);null!=a.enableAdaptation&&this.J.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.ea=Number(a.mpdRequestTimeout));null!=a.liveStreamEndTimeout&&(this.Za=Number(a.liveStreamEndTimeout));null!=a.preferredLanguage&&(this.L=lb(String(a.preferredLanguage)));null!=a.restrictions&&(this.h=a.restrictions,
this.T&&lg(this))};X.prototype.destroy=function(){this.A.destroy();this.fa.destroy();this.fa=this.A=null;this.Z&&(window.clearTimeout(this.Z),this.Z=null);this.W&&(window.clearTimeout(this.W),this.W=null);this.o=null;this.i.destroy();this.i=null;pb(this.c).forEach(function(a){a.destroy()});this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.J.destroy();this.parent=this.h=this.V=this.f=this.g=this.$=this.J=null};m=X.prototype;
m.mb=function(a,b){if(!this.T){var c=Error("Cannot call attach() right now.");c.type="app";return Promise.reject(c)}this.parent=a;this.f=b;this.V=a.sb();C(this.i,this.g,"sourceopen",this.Db.bind(this));C(this.i,this.$,"bandwidth",this.Yb.bind(this));this.a.b&&(C(this.i,a,"bufferingStart",this.Ab.bind(this)),C(this.i,a,"bufferingEnd",this.zb.bind(this)));c=this.f.mediaKeys;this.f.src=window.URL.createObjectURL(this.g);c=this.f.setMediaKeys(c);return Promise.all([this.A,c])};
m.Y=function(){if(this.T){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);a=this.a.a;$f(a);ag(a);if(0==this.a.a.length||0==this.a.a[0].a.length)return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.T=!0;this.H.initialStreamBufferSize=this.a.c;kg(this);lg(this);
return Promise.resolve()};m.jb=function(a){var b=Date.now(),c=this.W=null,d=this.a.g;(a?this.hb():this.ib(d)).then(H(this,function(a){c=new cg(a);return c.update(this.a)})).then(H(this,function(a){c.destroy();c=null;for(var d=0;d<a.length;++d)mg(this,a[d]);this.H.initialStreamBufferSize=this.a.c;kg(this);lg(this);0==Object.keys(this.c).length?ng(this):og(this,(Date.now()-b)/1E3)})).catch(H(this,function(a){c&&(c.destroy(),c=null);"aborted"!=a.type&&(a=z(a),this.dispatchEvent(a),this.a&&og(this,0))}))};
m.ib=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};m.hb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};function og(a,b){if(null!=a.a.f){var c=Math.max(a.a.f,3),c=Math.max(c-b,0);a.W=window.setTimeout(a.jb.bind(a,!1),1E3*c)}}
function mg(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.ia()==b){var e=a.b.get(b.a.split("/")[0]).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.N&&a.K});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=z(c);a.dispatchEvent(c);return}a.o[c].Ua==b&&delete a.o[c];d.oa(e[0],!0);b.destroy()}b.destroy()}
m.na=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.ia():null)?a.G:0,b=[],c=this.b.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.m.length;++f){var g=e.m[f];if(g.N&&g.K){var h=g.G,g=new sa(h,g.bandwidth,g.width,g.height);h==a&&(g.active=!0);b.push(g)}}return b};X.prototype.getVideoTracks=X.prototype.na;
X.prototype.ra=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.ia():null)?a.G:0,b=[],c=this.b.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.m.length;++g){var h=e.m[g];if(h.N&&h.K){var l=h.G,h=new ia(l,h.bandwidth,f);l==a&&(h.active=!0);b.push(h)}}return b};X.prototype.getAudioTracks=X.prototype.ra;
X.prototype.Sa=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.ia():null,b=b?b.G:0,c=[],d=this.b.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.m.length;++h){var l=f.m[h].G,k=new ra(l,g);l==b&&(k.active=!0,k.enabled=a.wa());c.push(k)}return c};X.prototype.getTextTracks=X.prototype.Sa;X.prototype.nb=function(){return Number(this.H.initialStreamBufferSize)};
X.prototype.fb=function(){var a;if(this.T){a=this.a.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,Ne(a.a[c]));a=b}else a=[];return a};
X.prototype.Na=function(a){if(this.T){for(var b={},c=this.a.a[0],d=0;d<c.a.length;++d){var e=c.a[d];b[e.G]=e}this.b.a={};c=xb(a);for(d=0;d<c.length;++d){var e=c[d],f=a.get(e);if("video"==e){var g=f[0].id;this.b.push(e,b[g])}else if("audio"==e)for(var g=f[0].b.split(";")[0],h=0;h<f.length;++h){var l=f[h];l.b.split(";")[0]==g&&this.b.push(e,b[l.id])}else for(h=0;h<f.length;++h)g=f[h].id,this.b.push(e,b[g])}this.ga=!0;if(a=this.b.get("audio"))pg(this,a),this.b.set("audio",a),a=a[0].lang||this.L,kb(2,
this.L,a)&&(this.ga=!1);if(a=this.b.get("text"))pg(this,a),this.b.set("text",a),a=a[0].lang||this.L,kb(2,this.L,a)||(this.ga=!1)}};X.prototype.selectVideoTrack=function(a,b,c){return qg(this,"video",a,b,c)};m=X.prototype;m.pb=function(a,b,c){return qg(this,"audio",a,b,c)};m.qb=function(a,b){return qg(this,"text",a,b)};m.Ra=function(a){var b=this.c.text;b&&b.qa(a)};m.rb=function(a){this.aa=a};
function lg(a){if(a.h){for(var b=!1,c=0;c<a.a.a.length;++c)for(var d=a.a.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.m.length;++g){var h=f.m[g],l=h.K;h.K=!0;a.h.maxWidth&&h.width>a.h.maxWidth&&(h.K=!1);a.h.maxHeight&&h.height>a.h.maxHeight&&(h.K=!1);a.h.minHeight&&h.height<a.h.minHeight&&(h.K=!1);a.h.maxBandwidth&&h.bandwidth>a.h.maxBandwidth&&(h.K=!1);a.h.minBandwidth&&h.bandwidth<a.h.minBandwidth&&(h.K=!1);l!=h.K&&(b=!0)}}0!=vb(a.b).length&&b&&(rg(a),0<a.na().length||
(b=Error("The application has restricted all video tracks!"),b.type="app",b=z(b),a.dispatchEvent(b)))}}m.xa=function(){return[]};m.ja=function(){return!1};m.ob=function(){return this.a?this.a.b:!1};
m.gb=function(a){for(var b,c=!1,d=new A,e=vb(this.b),f=0;f<e.length;++f)for(var g=e[f],h=0;h<g.m.length;++h){var l=g.m[h];l.f.forEach(function(a){d.push(a,l)})}for(b in a)if(e=hb[a[b]]||null,g=d.get(b))for(f=0;f<g.length;++f)l=g[f],h=l.N,l.N=!e,h!=l.N&&(c=!0);else Cb(b);c&&(rg(this),b=this.ra(),a=this.na(),b=this.b.a.hasOwnProperty("audio")&&0==b.length,a=this.b.a.hasOwnProperty("video")&&0==a.length,b||a)&&(a=Error("The key system has restricted all "+(b&&a?"audio and video tracks.":b?"audio tracks.":
"video tracks.")),a.type="drm",a=z(a),this.dispatchEvent(a))};function rg(a){var b=y({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function qg(a,b,c,d,e){if(!a.b.a.hasOwnProperty(b)||!a.c[b])return!1;for(var f=a.b.get(b),g=0;g<f.length;++g)for(var h=f[g],l=0;l<h.m.length;++l){var k=h.m[l];if(k.G==c){if(!k.N||!k.K)return!1;if("text"!=b&&!a.Wa)return c=a.o[b],a.o[b]={Ua:k,ab:null!=c&&c.ab||d,bb:null!=c&&c.bb||e},!0;wf(a.V,k);a.c[b].oa(k,d,e);return!0}}return!1}
function pg(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(kb(c,a.L,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.b){b.splice(d,1);b.splice(0,0,e);break}}m.Db=function(){this.i.ta(this.g,"sourceopen");ng(this).then(H(this,function(){this.A&&this.A.resolve()})).catch(H(this,function(a){this.A&&this.A.reject(a)}))};
function ng(a){for(var b=[],c=["audio","video","text"],d=0;d<c.length;++d){var e=c[d];a.b.a.hasOwnProperty(e)&&b.push(a.b.get(e)[0])}for(var f=sg(a,b),d=0;d<c.length;++d)if(e=c[d],a.b.a.hasOwnProperty(e)&&!f[e])return a=Error("Unable to select an initial "+e+" stream: all "+e+" streams have been restricted (by the application or by the key system)."),a.type="stream",Promise.reject(a);b=pb(f).map(function(a){return a.C.create()});return Promise.all(b).then(H(a,function(a){if(!a.every(function(a){return a.length()}))return a=
Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=tg(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!ug(this,f))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.J.start();vg(this,f,a);return Promise.resolve()})).catch(H(a,function(a){if("aborted"!=a.type)return Object.keys(this.c),this.a.b?(Sa()<this.a.h?(a=Math.max(this.a.h-Date.now()/1E3,3),this.W=window.setTimeout(this.jb.bind(this,
!0),1E3*a)):og(this,0),Promise.resolve()):Promise.reject(a)}))}function sg(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.J.getInitialVideoTrackId();if(null==g)continue;f=e.m.filter(function(a){return a.G==g});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType){f=e.m.filter(function(a){return a.N&&a.K});if(0==f.length)continue;f=e.m[Math.floor(f.length/2)]}else 0<e.m.length&&(f=e.m[0]);c[e.contentType]=f}return c}
function ug(a,b){var c={},d;for(d in b){var e=b[d],f="text"===d,g=e.C.F?!!e.C.F.w:!1,h;f&&g?h=wg(a):f?h=new ff(a,a.f):h=xg(a,e);if(!h)return pb(c).forEach(function(a){a.destroy()}),!1;c[d]=h}a.c=c;return!0}function xg(a,b){var c=new Xe(a,a.f,a.g,Ke(b),a.$);c.za(a.H);return c}function wg(a){var b=a.f;return new Re(a,b,b.textTracks)}
function vg(a,b,c){a.$a=a.f.playbackRate;a.f.playbackRate=0;yg(a,c);var d;a.aa&&a.aa<=c.end&&a.aa>=c.start?d=a.aa:a.a.b?(d=c.end,a.Xa=!0):d=c.start;C(a.i,a.f,"seeking",a.Lb.bind(a));a.f.currentTime!=d&&(a.f.currentTime=d,a.D=d);zg(a,c.start,c.end);c=[];for(var e in a.c){d=a.c[e];c.push(d.Ta(a.fa));C(a.i,d,"ended",a.Mb.bind(a));var f=b[e];wf(a.V,f);d.oa(f,!1)}Promise.all(c).then(a.yb.bind(a)).catch(H(a,function(a){"destroy"!=a.type&&(a=z(a),this.dispatchEvent(a))}));a.Ra(a.ga)}
m.yb=function(a){ba(a&&a.length==Object.keys(this.c).length);for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);a=Ag(this);for(d=0;d<a.length;++d)a[d].ma(c);Bg(this,a,c);d=vb(this.b).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){var b=[a.C.create()];a.I&&b.push(a.I.create());return Promise.all(b)});Promise.all(d).then(H(this,function(a){for(var b=0;b<a.length;++b)a[b][0].ma(c);this.Wa=
!0;for(var d in this.o)a=this.o[d],b=this.c[d],wf(this.V,a.Ua),b.oa(a.Ua,a.ab,a.bb);this.o={}})).catch(H(this,function(a){"aborted"!=a.type&&(a=z(a),this.dispatchEvent(a))}))};function Bg(a,b,c){if(b=tg(a,b))yg(a,b),zg(a,b.start,b.end);0!=c&&(c=a.f.currentTime+c,a.f.currentTime=c,a.D=c);a.Xa&&b&&(a.f.currentTime=b.end);a.f.playbackRate=a.$a;a.a.b&&null!=a.a.f&&og(a,0);Cg(a);a.fa.resolve()}
function yg(a,b){if(a.a.b)isNaN(a.g.duration)&&(a.g.duration=b.end+2592E3);else if(isNaN(a.g.duration)||b.end>a.g.duration){a.g.duration=b.end;for(var c=0;c<a.g.sourceBuffers.length;++c)a.g.sourceBuffers[c].appendWindowEnd=b.end}}m.Ob=function(){this.Z=null;Cg(this);var a=tg(this,Ag(this));a&&(this.a.b&&this.Ya!=a.B&&(this.Ya=a.B,null!=this.v&&(window.clearTimeout(this.v),this.v=null)),zg(this,a.start,a.end),this.f.paused||Dg(this,this.f.currentTime,a.start,a.end))};
function zg(a,b,c){b=y({type:"seekrangechanged",bubbles:!0,start:b,end:c});a.dispatchEvent(b)}m.Lb=function(){var a=this.f.currentTime;if(null!=this.D){if(a>=this.D-.01&&a<=this.D+.01){this.D=null;return}this.D=null}var b=tg(this,Ag(this));if(b){var c=b.end;(b=Dg(this,a,b.start,c))||(a<=c+.01?b=!1:(this.f.currentTime=c,b=!0));if(!b)for(var d in this.c)this.c[d].La()}};
function Dg(a,b,c,d){if(b>=c-.01)return!1;b=0;if(a.a.b){b=.5;for(var e in a.c)if(!a.c[e].Qa(c+b)){b=a.a.c;break}}a.f.currentTime=Math.min(c+b,d);return!0}m.Mb=function(){if(!this.a.b){for(var a in this.c)if(!this.c[a].ya())return;this.eb()}};m.Ab=function(){pb(this.c).every(function(a){return a.ya()})&&(this.v=window.setTimeout(this.eb.bind(this),1E3*this.Za))};m.zb=function(){null!=this.v&&(window.clearTimeout(this.v),this.v=null)};
m.Yb=function(){var a=this.V,b=this.$.getBandwidth();a.estimatedBandwidth=b;a.bandwidthHistory.push(new yf(b))};m.eb=function(){this.v=null;this.g.endOfStream()};function Ag(a){return pb(a.c).map(function(a){return a.Ha()}).filter(function(a){return null!=a})}
function tg(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].Ga(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].B().endTime))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.a[0],d.b)d=(d.start||0)+d.b;else return null;a.a.b&&(d=Math.max(d-a.a.c,c));return c>d?null:{start:c,end:d,B:e}}function Cg(a){a.a.b&&(a.Z=window.setTimeout(a.Ob.bind(a),1E3))}function kg(a){for(var b in a.c)a.c[b].za(a.H)};function Y(a,b,c,d,e){c||(c=new Bb);d||(d=new W);X.call(this,null,c,d);this.Ca=a;this.l=null;this.M=b;this.R=[];this.ha=[];this.ua=[];this.j=null;this.va=e}r(Y,X);q("shaka.player.DashVideoSource",Y);Y.prototype.Da=function(a,b,c){this.R.push(a);this.ha.push(b||"");this.ua.push(c||"")};Y.prototype.addExternalCaptions=Y.prototype.Da;Y.prototype.vb=function(a){this.j=a};Y.prototype.setNetworkCallback=Y.prototype.vb;Y.prototype.destroy=function(){this.l=this.j=this.M=null;X.prototype.destroy.call(this)};
Y.prototype.Y=function(){var a=new I(this.j,[new J(this.Ca)]);return ce(new be(a,this.ea,this.va)).then(H(this,function(a){this.l=a;for(var c=0;c<this.R.length;c++){var d=a,e=this.R[c],f=this.ha[c],g=this.ua[c];if(0!==d.a.length){var h=new rd;h.contentType="text";h.lang=f||"en";h.c=!0;f=new ud;f.bandwidth=0;f.c=g||"text/vtt";f.u=[new J(e)];h.a.push(f);d.a[0].b.push(h);Nd(d.a[0])}}this.a=kf(new jf(this.M),a,this.j);return X.prototype.Y.call(this)}))};
Y.prototype.ib=function(a){return ce(new be(a,this.ea,this.va)).then(H(this,function(a){this.l=a;a=kf(new jf(this.M),a,this.j);return Promise.resolve(a)}))};Y.prototype.hb=function(){var a=kf(new jf(this.M),this.l,this.j);return Promise.resolve(a)};function Z(a,b,c){b||(b=new Bb);c||(c=new W);X.call(this,null,b,c);this.R=a;this.M=[];this.timeoutMs=3E4;this.l={};this.j=this.ha=null}r(Z,X);q("shaka.player.OfflineVideoSource",Z);Z.prototype.U=function(a){null!=a.licenseRequestTimeout&&(this.l.licenseRequestTimeout=a.licenseRequestTimeout);null!=a.segmentRequestTimeout&&(this.l.segmentRequestTimeout=a.segmentRequestTimeout);X.prototype.U.call(this,a)};
q("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var a=new Qb,b=Ib(a).then(function(){return Rb(a)});b.then(function(){Kb(a)}).catch(function(){Kb(a)});return b});
Z.prototype.Da=function(a,b,c,d){var e,f=null,g={},h=[];a=new I(this.ha,[new J(a)]);return ce(new be(a,this.ea)).then(H(this,function(a){this.a=kf(new jf(c),a,this.ha);if(this.a.b)return a=Error("Unable to store live streams offline."),a.type="app",Promise.reject(a);this.U({preferredLanguage:b});return X.prototype.Y.call(this)})).then(H(this,function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.g);e=new If(null,a,this);null!=this.l.licenseRequestTimeout&&(e.v=Number(this.l.licenseRequestTimeout));
C(this.i,e,"sessionReady",this.ua.bind(this));C(this.i,e,"error",function(a){f=a});return e.initialize()})).then(H(this,function(){for(var a=vb(this.b),b=0;b<a.length;++b)for(var c=a[b],e=0;e<c.m.length;++e){var f=c.m[e];g[f.G]=f}return d()})).then(H(this,function(a){for(var b=0;b<a.length;++b){var c=a[b],d=g[c];if(d)h.push(d);else return Promise.reject(Error("Invalid stream ID chosen: "+c))}var e=["audio","video"];h=h.filter(function(a){return 0>e.indexOf(a.a.split("/")[0])?!1:!0});a=h.map(function(a){return a.I.create()});
return Promise.all(a)})).then(H(this,function(a){for(var b=h,c=[],d=0;d<b.length;++d)try{c[d]=this.g.addSourceBuffer(Ke(b[d]))}catch(e){}if(b.length!=c.length)a=Error("Error initializing streams."),a.type="storage",a=Promise.reject(a);else{for(d=0;d<a.length;++d)(b=a[d])&&c[d].appendBuffer(b);a=Promise.resolve()}return a})).then(H(this,function(){return Lf(e,this.timeoutMs)})).then(H(this,function(){return f?Promise.reject(f):Eg(this,h,e.a,this.a.a[0].b)})).then(H(this,function(a){this.R=a;return f?
(Fg(this),Promise.reject(f)):Promise.resolve(a)}))};q("shaka.player.OfflineVideoSource.prototype.store",Z.prototype.Da);Z.prototype.Ca=function(a){this.ha=a};Z.prototype.setNetworkCallback=Z.prototype.Ca;Z.prototype.ua=function(a){this.M.push(a.detail.sessionId)};
function Eg(a,b,c,d){var e=new zf(a.$,a);null!=a.l.segmentRequestTimeout&&(e.b=Number(a.l.segmentRequestTimeout));return Ib(e).then(H(a,function(){return Af(e,b,this.M,d,c)})).then(function(a){Kb(e);return Promise.resolve(a)}).catch(function(a){Kb(e);return Promise.reject(a)})}
Z.prototype.Y=function(){var a=new Qb,b,c;return Ib(a).then(H(this,function(){return Sb(a,this.R)})).then(H(this,function(d){var e=[];this.M=d.session_ids;b=d.duration;c={keySystem:d.key_system,distinctiveIdentifierRequired:d.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:d.audio_robustness,videoRobustness:d.video_robustness,withCredentials:d.with_credentials,licenseServerUrl:d.license_server};for(var f=0;f<d.stream_ids.length;++f)e.push(Tb(a,d.stream_ids[f]));return Promise.all(e)})).then(H(this,
function(a){var e=b,f=c,g=new Qe;g.c=5;for(var h=new Pe,l=0;l<a.length;++l){var k=a[l],p=new Ie,n=new He(k.references),t=new ie(null,k.init_segment);p.C=n;p.I=t;p.a=k.mime_type;p.b=k.codecs;p.N=!0;this.j&&(null!=this.j.licenseServerUrl&&(f.licenseServerUrl=this.j.licenseServerUrl),null!=this.j.withCredentials&&(f.withCredentials=this.j.withCredentials),f.licensePostProcessor=this.j.licensePostProcessor,f.licensePreProcessor=this.j.licensePreProcessor,f.serverCertificate=this.j.serverCertificate);
k=mc(f);n=new Le;n.m.push(p);n.a.push(k);n.contentType=p.a.split("/")[0];h.a.push(n);h.b=e}g.a.push(h);this.a=g;return X.prototype.Y.call(this)})).then(function(){Kb(a);return Promise.resolve()}).catch(function(b){Kb(a);return Promise.reject(b)})};
Z.prototype.va=function(a,b){a&&(this.j={licenseServerUrl:a.licenseServerUrl,withCredentials:a.withCredentials,serverCertificate:a.serverCertificate,licensePreProcessor:a.licensePreProcessor,licensePostProcessor:a.licensePostProcessor});var c=null;return Gg(this).catch(function(a){return b?(c=a,Promise.resolve()):Promise.reject(a)}).then(H(this,function(){return Fg(this)})).then(function(){return Promise.resolve(c)})};Z.prototype.deleteGroup=Z.prototype.va;Z.prototype.xa=function(){return this.M};
Z.prototype.ja=function(){return!0};function Fg(a){var b=new zf(null,null);return Ib(b).then(H(a,function(){return Df(b,this.R)})).then(function(){Kb(b);return Promise.resolve()}).catch(function(a){Kb(b);return Promise.reject(a)})}
function Gg(a){var b=document.createElement("video");b.src=window.URL.createObjectURL(a.g);var c=new If(null,b,a);null!=a.l.licenseRequestTimeout&&(c.v=Number(a.l.licenseRequestTimeout));return a.Y().then(function(){return c.initialize()}).then(H(a,function(){return Lf(c,this.timeoutMs)})).then(function(){return Mf(c)}).then(H(a,function(){c.destroy();this.destroy();return Promise.resolve()})).catch(H(a,function(a){c.destroy();this.destroy();return Promise.reject(a)}))};}.bind(g,this))();
if (typeof(module)!="undefined"&&module.exports)module.exports=g.shaka;
else if (typeof(define)!="undefined" && define.amd)define(function(){return g.shaka});
else this.shaka=g.shaka;
})();

